import{b as Re,r as S,R as r,j as I}from"./index-B5q0XL7m.js";import{bi as Te,O as W,a5 as Pe,$,b3 as ze,S as _e,ak as Le,a$ as Ae,W as Be,bj as Me,Z as N,B as F,ac as Q,b as P,a_ as Ue,aY as De,bk as qe,N as te,R as Ne,k as X,T as We,F as xe,aq as $e,_ as Ve,as as Ge}from"./FirebaseUtils-DPMbTUBM.js";import{L as He}from"./LongPressButton-BsvFwpmp.js";import{u as Ye}from"./useAccountSync-DDLkXJ2F.js";import{P as he}from"./Paragraph-BUVxZt4F.js";import{A as ee}from"./Anchor-DTLE72rf.js";import{L as Ze}from"./List-DvMgEvam.js";var A={},be;function Je(){if(be)return A;be=1,A.__esModule=!0,A.CircleAlert=void 0;var e=o(Re()),f=Te();function l(u){if(typeof WeakMap!="function")return null;var a=new WeakMap,n=new WeakMap;return(l=function(k){return k?n:a})(u)}function o(u,a){if(u&&u.__esModule)return u;if(u===null||typeof u!="object"&&typeof u!="function")return{default:u};var n=l(a);if(n&&n.has(u))return n.get(u);var d={__proto__:null},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in u)if(b!=="default"&&Object.prototype.hasOwnProperty.call(u,b)){var E=k?Object.getOwnPropertyDescriptor(u,b):null;E&&(E.get||E.set)?Object.defineProperty(d,b,E):d[b]=u[b]}return d.default=u,n&&n.set(u,d),d}function C(){return C=Object.assign?Object.assign.bind():function(u){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var d in n)Object.prototype.hasOwnProperty.call(n,d)&&(u[d]=n[d])}return u},C.apply(this,arguments)}var y=A.CircleAlert=(0,e.forwardRef)(function(u,a){return e.default.createElement(f.StyledIcon,C({ref:a,viewBox:"0 0 24 24",a11yTitle:"CircleAlert"},u),e.default.createElement("path",{stroke:"#000",strokeWidth:"2",fill:"none",d:"M12 14V6m0 12v-2m0-14C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z"}))});return y.displayName="CircleAlert",A}var Ke=Je(),Qe=W.input.withConfig(Pe).attrs($).withConfig({displayName:"StyledFileInput",componentId:"sc-rl7ywv-0"})(["position:absolute;height:100%;width:100%;"," font-size:0;opacity:0;border:none;"," "," &::-moz-focus-inner{border:none;outline:none;}&::-webkit-file-upload-button{cursor:pointer;}"],ze,function(e){return!e.disabled&&"cursor: pointer;"},function(e){return e.rightOffset&&`
    width: calc(100% - `+e.rightOffset+`px);
    right: `+e.rightOffset+`px;
    `}),Xe={},et=Xe,tt=1e3,nt=1024,rt=function(){var f=["Win","Linux","Mac"].find(function(l){var o;if(typeof window<"u")return((o=window)==null||(o=o.navigator)==null||(o=o.userAgent)==null?void 0:o.indexOf(l))>=0});return f},at=function(f){for(var l=["B","KB","MB","GB","TB"],o=tt,C=0,y=f;y>=o&&C<l.length-1;)y/=o,C+=1;return y.toFixed(1)+" "+l[C]},it=function(f){var l=Math.ceil(f/nt);return Intl.NumberFormat().format(l)+" KB"},lt=function(f){return function(l){switch(f){case"Win":return it(l);default:return at(l)}}},ot=lt(rt()),ut=["a11yTitle","background","border","confirmRemove","disabled","id","plain","renderFile","maxSize","messages","margin","multiple","name","onChange","pad","value"];function R(){return R=Object.assign?Object.assign.bind():function(e){for(var f=1;f<arguments.length;f++){var l=arguments[f];for(var o in l)({}).hasOwnProperty.call(l,o)&&(e[o]=l[o])}return e},R.apply(null,arguments)}function ct(e,f){if(e==null)return{};var l={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(f.includes(o))continue;l[o]=e[o]}return l}var st=W(F).attrs($).withConfig({displayName:"FileInput__ContentsBox",componentId:"sc-1jzq7im-0"})(["cursor:pointer;position:relative;"," ",";",";",";",";",";"],function(e){return e.disabled&&Ue()},function(e){return e.theme.fileInput&&e.theme.fileInput.extend},function(e){return e.hover&&e.theme.fileInput&&e.theme.fileInput.hover&&e.theme.fileInput.hover.extend},function(e){return e.dragOver&&e.theme.fileInput&&e.theme.fileInput.dragOver&&e.theme.fileInput.dragOver.extend},function(e){return e.focus&&De()},function(e){return!e.focus&&qe()}),Ie=W(te).attrs($).withConfig({displayName:"FileInput__Label",componentId:"sc-1jzq7im-1"})(["",";"],function(e){return e.theme.fileInput&&e.theme.fileInput.label&&e.theme.fileInput.label.extend}),ft=W(te).attrs($).withConfig({displayName:"FileInput__Message",componentId:"sc-1jzq7im-2"})(["",";"],function(e){return e.theme.fileInput&&e.theme.fileInput.message&&e.theme.fileInput.message.extend}),Ce={event:void 0,index:void 0},ne=S.forwardRef(function(e,f){e.a11yTitle,e.background,e.border;var l=e.confirmRemove,o=e.disabled,C=e.id,y=e.plain,u=e.renderFile,a=e.maxSize,n=e.messages;e.margin;var d=e.multiple,k=e.name,b=e.onChange;e.pad;var E=e.value,we=ct(e,ut),g=_e(),Se=S.useContext(Le),x=Se.format,ye=S.useContext(Ae),re=r.useState(),ae=re[0],ie=re[1],le=r.useState(),oe=le[0],V=le[1],ue=r.useState(),Fe=ue[0],ce=ue[1],se=S.useState(!1),ke=se[0],B=se[1],fe=S.useState(Ce),Ee=fe[0],G=fe[1],M=d&&d.aggregateThreshold||10,z=d==null?void 0:d.max,m=Be(f),p=S.useRef(),U=S.useRef(),Oe=l,de=g.fileInput.icons.remove,je=Me(),me=ye.useFormInput({name:k,value:E,initialValue:[],validate:[a?function(){var c=[].concat(v),t="",s=c.filter(function(w){var h=w.size;return h>a}).length;if(s){var i="fileInput.maxSizeSingle";d&&(i="fileInput.maxSizeMultiple."+(s===1?"singular":"plural")),t=x({id:i,messages:n,values:{maxSize:ot(a),numOfFiles:s}})}return t}:"",z?function(){var c=[].concat(v),t="";return c.length>z&&(t=x({id:"fileInput.maxFile",messages:n,values:{max:z}})),t}:""]}),v=me[0],ge=me[1],j=function(t,s){var i={},w=g.fileInput[t];w&&(typeof w!="object"?s?i[s]=w:i=w:i=R({},w));var h=g.fileInput.hover[t];ae&&h&&(typeof h!="object"?s?i[s]=h:i=h:i=R({},i,h));var O=g.fileInput.dragOver[t];return oe&&O&&(typeof O!="object"?s?i[s]=O:i=O:i=R({},i,O)),typeof i=="object"&&Object.keys(i).length===0?void 0:i},_;if(j("pad")){var ve=j("pad"),H=ve.horizontal,Y=ve.right;Y?_=g.global.edgeSize[Y]||Y:H&&(_=g.global.edgeSize[H]||H)}var T;if(U.current&&p.current){var Z=p.current.getBoundingClientRect().width,D=U.current.getBoundingClientRect().width;_&&typeof _=="string"&&(T=D+N(_)),v.length===1||v.length>M?T=Z+D+N(g.global.edgeSize.small)*2:Z>D?T=Z+N(g.global.edgeSize.small)*2:T=D}else!v.length&&p.current&&(T=p.current.getBoundingClientRect().width+N(g.global.edgeSize.small)*2);var J;v.length?J=v.length+" items":J=x({id:d?"fileInput.dropPromptMultiple":"fileInput.dropPrompt",messages:n});var K=function(t){var s;t==="all"?s=[]:(s=[].concat(v),s.splice(t,1)),ge(s);var i=new DataTransfer,w=m.current.files;(t==="all"||s.length===0)&&(m.current.value="");for(var h=0;h<w.length;h+=1){var O=w[h];t!==h&&i.items.add(O)}var L=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"files").set;L.call(m.current,i.files);var q=new Event("input",{bubbles:!0});m.current.dispatchEvent(q),b&&b(q,{files:s}),m.current.focus()};return r.createElement(r.Fragment,null,r.createElement(st,{theme:g,flex:!1,disabled:o,background:j("background","color"),border:y?void 0:j("border","side"),margin:j("margin"),pad:j("pad"),round:j("round","size"),align:v.length?"stretch":"center",justify:"center",hover:ae,onMouseOver:o?void 0:function(){return ie(!0)},onMouseOut:o?void 0:function(){return ie(!1)},dragOver:oe,focus:je&&Fe},r.createElement(Qe,R({ref:m,type:"file",id:C,name:k,maxSize:a,multiple:d,disabled:o,plain:!0,rightOffset:T},we,{onDragOver:function(){return V(!0)},onDragLeave:function(){return V(!1)},onChange:function(t){t.persist();for(var s=t.target.files,i=d?[].concat(v):[],w=function(L){var q=i.filter(function(pe){return pe.name===s[L].name&&pe.size===s[L].size}).length>0;q||i.push(s[L])},h=0;h<s.length;h+=1)w(h);ge(i),V(!1),b&&b(t,{files:i})},onBlur:function(){return ce(!1)},onFocus:function(){return ce(!0)}})),(!v.length||v.length>1)&&r.createElement(F,{align:"center",fill:"horizontal",direction:"row",justify:"between"},v.length<=M&&r.createElement(r.Fragment,null,r.createElement(ft,g.fileInput.message,J),r.createElement(Q,{onSpace:function(t){t.preventDefault(),p.current===t.target&&m.current.click()},onEnter:function(t){p.current===t.target&&m.current.click()}},g.fileInput.button?r.createElement(P,{tabIndex:-1,ref:p,kind:g.fileInput.button,label:x({id:"fileInput.browse",messages:n}),onClick:function(){m.current.click(),m.current.focus()}}):r.createElement(ee,{tabIndex:-1,alignSelf:"center",ref:p,margin:"small",onClick:function(){m.current.click(),m.current.focus()},label:x({id:"fileInput.browse",messages:n})})))),v.length>M&&r.createElement(F,{justify:"between",direction:"row",align:"center"},r.createElement(Ie,g.fileInput.label,v.length," ",x({id:"fileInput.files",messages:n})),r.createElement(F,{flex:!1,direction:"row",align:"center"},r.createElement(P,{ref:U,a11yTitle:x({id:"fileInput.removeAll",messages:n}),icon:r.createElement(de,null),hoverIndicator:!0,onClick:function(t){l?(t.persist(),G({event:t,index:"all"}),B(!0)):K("all")}}),r.createElement(Q,{onSpace:function(t){p.current===t.target&&m.current.click()},onEnter:function(t){p.current===t.target&&m.current.click()}},g.fileInput.button?r.createElement(P,{tabIndex:-1,ref:p,kind:g.fileInput.button,label:x({id:"fileInput.browse",messages:n}),onClick:function(){m.current.click(),m.current.focus()}}):r.createElement(ee,{tabIndex:-1,alignSelf:"center",ref:p,margin:"small",onClick:function(){m.current.click(),m.current.focus()},label:x({id:"fileInput.browse",messages:n})})))),v.length>0&&v.length<=M&&v.map(function(c,t){return r.createElement(F,{key:c.name,justify:"between",direction:"row",align:"center"},u?u(c):r.createElement(F,R({},g.fileInput.label,{gap:"xsmall",align:"center",direction:"row"}),(a&&c.size>a||z&&t>=z)&&r.createElement(Ke.CircleAlert,null),r.createElement(Ie,{weight:g.global.input.weight||g.global.input.font.weight,truncate:!0},c.name)),r.createElement(F,{flex:!1,direction:"row",align:"center"},r.createElement(P,{ref:t?void 0:U,a11yTitle:x({id:"fileInput.remove",messages:n})+" "+c.name,icon:r.createElement(de,null),hoverIndicator:!0,onClick:function(i){l?(i.persist(),G({event:i,index:t}),B(!0)):K(t)}}),v.length===1&&r.createElement(Q,{onSpace:function(i){p.current===i.target&&m.current.click()},onEnter:function(i){p.current===i.target&&m.current.click()}},g.fileInput.button?r.createElement(P,{tabIndex:-1,ref:p,kind:g.fileInput.button,label:x({id:"fileInput.browse",messages:n}),onClick:function(){m.current.click(),m.current.focus()}}):r.createElement(ee,{tabIndex:-1,ref:p,margin:"small",onClick:function(){m.current.click(),m.current.focus()},label:x({id:"fileInput.browse",messages:n})}))))})),ke&&r.createElement(Oe,{onConfirm:function(){K(Ee.index),G(Ce),B(!1)},onCancel:function(){return B(!1)}}))});ne.displayName="FileInput";ne.propTypes=et;function Ct(e){const{state:f}=S.useContext(Ne),l=Ye(),[o,C]=S.useState(null);S.useEffect(()=>{l&&f.user.hasStorage&&X.GetCurrentUserUploads(l,e.fileType).then(a=>{C(a)})},[l,f.user.hasStorage,e.fileType]);const y=I.jsx(dt,{currentUrl:e.currentUrl,onSubmit:a=>{e.onFileSelect({name:a,url:a})}});if(!(l&&f.user.hasStorage))return e.allowDirectLink?y:I.jsx(he,{children:"Storage not available. Please log in to upload a file."});const u=o&&I.jsx(Ze,{style:{overflowY:"auto"},data:o,onClickItem:a=>{a.item&&e.onFileSelect(a.item)},action:a=>I.jsx(He,{icon:I.jsx(xe,{icon:Ge}),onLongPress:async()=>{await X.DeleteFile(l,e.fileType,a.name),e.currentUrl===a.url&&e.onFileSelect({name:"",url:""}),C(n=>n?Ve.filter(n,d=>d.url!==a.url):[])},onClickCapture:n=>{n.stopPropagation()}})});return I.jsxs(F,{align:"stretch",children:[u||I.jsx(he,{children:"Loading..."}),I.jsx(ne,{onChange:async a=>{const n=a==null?void 0:a.target.files;if(!n||!n[0])return;const d=n[0],k=await X.UploadUserFileToStorageAndGetURL(d,l,e.fileType,(b,E)=>{console.log(`${b}/${E} uploaded`)});e.onFileSelect({name:d.name,url:k})},accept:e.fileInputAccept}),e.allowDirectLink&&y]})}function dt(e){const f=S.useRef(null);return I.jsxs(F,{direction:"row",align:"center",children:[I.jsx(te,{margin:"small",children:"URL: "}),I.jsx(We,{"aria-label":"URL",ref:f,defaultValue:e.currentUrl}),I.jsx(P,{onClick:()=>e.onSubmit(f.current.value),icon:I.jsx(xe,{icon:$e})})]})}export{dt as D,Ct as F};

import{r as c,j as t,a as d}from"./index-DiojgAgK.js";import{R as y,u as g,H as N,B as j,a as h,G as C,b,F as P,f as M,c as k,g as m,r as f,o as S,d as v,e as A,D,T as L,V as R,h as T,i as E,j as F,E as I,k as p,p as U}from"./FirebaseUtils-Br4SKQFO.js";import{u as B,C as O}from"./usePageTitle-KDece7ZW.js";import{P as V}from"./PlayerViewUserContext-Pr5iUODZ.js";import{u as G}from"./useUserIdFromActiveDashboard-t_VW60vp.js";function H(e){const[n,r]=c.useState("offline");return c.useEffect(()=>{const s=m(d);if(e){const o=f(s,`status/${e}`);return S(o,a=>{r(a.val())}),()=>v(o)}},[e]),n}const W=e=>{var i;const{state:n}=c.useContext(y),r=g(),s=G(),a=H(s)==="offline"?" [Offline]":"";return t.jsxs(N,{fill:"horizontal",background:"brand",pad:"small",gap:"none",height:"xsmall",children:[t.jsxs(j,{align:"center",direction:"column",fill:!0,children:[t.jsx(h,{level:1,size:"small",margin:"none",children:(i=C(n,r))==null?void 0:i.name}),t.jsxs(h,{level:2,size:"small",margin:"none",children:["Paragon Campaign Dashboard: Player View",a]})]}),t.jsx($,{}),t.jsx(b,{onClick:()=>e.setMatchGMLayout(!e.matchGMLayout),icon:t.jsx(P,{fixedWidth:!0,icon:e.matchGMLayout?M:k}),tip:e.matchGMLayout?"Matching GM layout":"Unlocked from GM layout"})]})};function $(){const[e,n]=c.useState(!1),r=c.useRef(null),s=c.useContext(V);return t.jsxs(t.Fragment,{children:[t.jsx(b,{onClick:()=>n(!e),icon:t.jsx(P,{fixedWidth:!0,icon:A}),tip:"Set Player Name",ref:r}),r.current&&e&&t.jsx(D,{target:r.current,align:{top:"bottom"},onClickOutside:()=>n(!1),children:t.jsx(L,{placeholder:"Player Name",defaultValue:s.name??void 0,onKeyDown:o=>{if(o.key!=="Enter")return;const a=o.target;a.value.length>0&&(s.setName(a.value),n(!1))}})})]})}function x(e,n){const[r,s]=c.useState(()=>{const a=localStorage.getItem(e);return a?JSON.parse(a):n});return[r,a=>{s(a),localStorage.setItem(e,JSON.stringify(a))}]}function z(e){const[n,r]=c.useState(I()),s=g();return c.useEffect(()=>{if(!e)return;const a=m(d),i=f(a,`users/${e}/playerViews/${s}`);return S(i,u=>{const l=u.val();if(!l)return;const w=p.restorePrunedEmptyArrays(l);r(w)}),()=>{v(i)}},[s,e]),[n,a=>{const i=p.removeUndefinedNodesFromTree(a),u=m(d),l=f(u,`pendingActions/${s}`);U(l,i)}]}function Y(){const e=G(),[n,r]=z(e),[s,o]=x("matchGmLayout",!0),[a,i]=x("playerName",null);return B(n),t.jsx(y.Provider,{value:{state:n,dispatch:r},children:t.jsx(R.Provider,{value:T.Player,children:t.jsx(V.Provider,{value:{name:a,setName:i},children:t.jsx(E,{style:{minHeight:"100%"},theme:F,children:t.jsxs(j,{fill:!0,align:"center",children:[t.jsx(W,{matchGMLayout:s,setMatchGMLayout:o}),t.jsx(O,{matchGMLayout:s,setMatchGMLayout:o})]})})})})})}export{Y as default};

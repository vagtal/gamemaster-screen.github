import{r as o,j as e}from"./index-DsPVNeCc.js";import{R as T,V as k,h as B,P,_ as S,M as w,T as f,C as d,B as s,au as V,b as g,F as u,bc as _,aV as I,aT as F,ar as N}from"./FirebaseUtils-HVElewoM.js";import{L as U}from"./LongPressButton-BLUHbYlB.js";import{u as O}from"./useScrollTo-DKVm9IpH.js";import{F as $}from"./FormField-BaXcWa9p.js";import{C as M}from"./CheckBoxGroup-BUQ6prG7.js";import{L as K}from"./List-D2GmBvKY.js";import"./Select-B2rWent2.js";const L="80px";function Z(m){const{dispatch:i}=o.useContext(T),{card:t}=m,l=o.useContext(k)!==B.Player||t.playerViewPermission===P.Interact,[h,c]=o.useState(!1),r=t.entries||[],E=r.length>0,D=O(r),p=o.useRef(null),j=o.useRef(null),b=S.sum(r.map(n=>n.changeAmount)),A=()=>{const n=j.current,a=p.current;if(!(a&&n))return;const C=parseInt(a.value);if(!isNaN(C)){const R=t.isDecreasing?-1:1;i(d.AddLedgerEntry({cardId:t.cardId,comment:n.value,changeAmount:C*R})),a.value="",n.value=""}},y=n=>{n.key==="Enter"&&A()};return h?e.jsxs(w,{cardState:t,commands:e.jsx(g,{active:!0,onClick:()=>c(!1),icon:e.jsx(u,{icon:I})}),children:[e.jsx($,{label:"Units",children:e.jsx(f,{placeholder:"e.g. money, experience points",value:t.units,onChange:n=>{i(d.SetLedgerUnits({cardId:t.cardId,units:n.target.value}))}})}),e.jsxs(s,{direction:"row",align:"center",children:[e.jsx(M,{label:"New entries decrease total",checked:t.isDecreasing,toggle:!0,onChange:n=>{i(d.SetLedgerDecreasing({cardId:t.cardId,isDecreasing:n.target.checked}))}}),e.jsx(V,{content:"Use this for ledgers that generally decrease, like hit points.",children:e.jsx(g,{icon:e.jsx(u,{icon:_})})})]})]}):e.jsxs(w,{cardState:t,commands:l&&e.jsx(g,{onClick:()=>c(!0),icon:e.jsx(u,{icon:I})}),children:[e.jsxs(s,{flex:!0,overflow:{vertical:"auto",horizontal:"hidden"},justify:"start",children:[E&&e.jsx(K,{data:r,pad:"xxsmall",show:r.length-1,children:(n,a)=>e.jsx(W,{card:t,entry:n,index:a},`${t.cardId}_${a}_${n.comment}_${n.changeAmount}`)}),e.jsx("div",{ref:D})]}),e.jsxs(s,{pad:"small",style:{fontWeight:"bold"},children:[b," ",t.units]}),l&&e.jsxs(s,{direction:"row",gap:"small",justify:"stretch",children:[e.jsx(s,{width:L,children:e.jsx(f,{type:"number",textAlign:"center",placeholder:t.isDecreasing?"-":"+",ref:p,onKeyDown:y})}),e.jsx(s,{flex:!0,fill:!0,children:e.jsx(f,{type:"text",placeholder:"Comment",ref:j,onKeyDown:y})})]})]})}const v=500;function W(m){const{card:i,entry:t,index:x}=m,{dispatch:l}=o.useContext(T),[h,c]=o.useState(!1),r=F("light-6");return e.jsxs(s,{direction:"row",align:"center",justify:"between",flex:!0,animation:h?{type:"fadeOut",duration:v}:void 0,children:[e.jsx(s,{width:L,align:"center",children:t.changeAmount}),e.jsx(s,{flex:!0,fill:!0,pad:"xsmall",children:t.comment}),e.jsx(U,{icon:e.jsx(u,{color:r,icon:N}),onLongPress:()=>{c(!0),setTimeout(()=>{c(!1),l(d.RemoveLedgerEntry({cardId:i.cardId,ledgerEntryIndex:x}))},v)}},x)]})}export{Z as default};

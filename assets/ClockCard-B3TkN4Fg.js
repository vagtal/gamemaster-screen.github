import{r as v,j as l,R as m}from"./index-Bu6bAEnZ.js";import{R,C as j,V as S,h as M,P as V,B as f,b,F as B,aS as F,aT as O,T as z,N as U,aU as J,M as Q,a as Z,aq as _,aV as p}from"./FirebaseUtils-DqQFU0Xq.js";import{F as L}from"./FormField-D98a86VO.js";import{u as ee}from"./useThrottled-HBroqHdh.js";import{T as te}from"./TextArea-CbEidRXW.js";import"./CheckBoxGroup-N3VBhegy.js";function D(e){const{dispatch:t}=v.useContext(R);return v.useCallback(n=>{let r=n+1;e.card.displayType==="radial"&&e.card.value===1&&r===1&&(r=0),t(j.SetClockValue({cardId:e.card.cardId,value:r}))},[e.card.cardId,e.card.value,e.card.displayType,t])}function ae(e){const a=v.useContext(S)!==M.Player||e.card.playerViewPermission===V.Interact,n=D(e);let r=[];for(let i=0;i<e.card.max;i++){const o=i<e.card.value?"brand":"light-6";r.push(l.jsx(f,{fill:!0,hoverIndicator:a&&{color:"brand-2"},background:o,onClick:a?()=>n(i):void 0},i))}return l.jsxs(f,{direction:"row",align:"center",fill:!0,children:[a&&l.jsx(b,{plain:!0,margin:"xsmall",fill:"vertical",icon:l.jsx(B,{icon:F}),color:e.card.value===0?"light-6":"brand",onClick:()=>n(-1)}),l.jsx(f,{direction:"row",fill:!0,gap:"xxsmall",justify:"stretch",children:r})]})}function w(e){return e*Math.PI/180}function N(e,t,a){return e>a?a:e<t?t:e}function E(e,t){return t/100*e}function K(e,t){return e+t/2}function $(e,t){var a=w(e);return{dx:t*Math.cos(a),dy:t*Math.sin(a)}}function q(e){return typeof e=="number"}function T(e,t){return typeof e=="function"?e(t):e}function ne(e,t){var a=Object.assign({},t,e);for(var n in t)e[n]===void 0&&(a[n]=t[n]);return a}function re(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].value;return t}function ie(e){for(var t=e.data,a=e.lengthAngle,n=e.totalValue,r=e.paddingAngle,i=e.startAngle,o=n||re(t),c=N(a,-360,360),u=Math.abs(c)===360?t.length:t.length-1,g=Math.abs(r)*Math.sign(a),s=g*u,d=c-s,h=0,k=[],x=0;x<t.length;x++){var I=t[x],A=o===0?0:I.value/o*100,P=E(d,A),y=h+i;h=h+P+g,k.push(Object.assign({percentage:A,startAngle:y,degrees:P},I))}return k}function X(e,t){if(e==null)return{};var a={},n=Object.keys(e),r,i;for(i=0;i<n.length;i++)r=n[i],!(t.indexOf(r)>=0)&&(a[r]=e[r]);return a}function le(e){var t=e.renderLabel,a=e.labelProps,n=t(a);if(typeof n=="string"||typeof n=="number"){a.dataEntry,a.dataIndex;var r=X(a,["dataEntry","dataIndex"]);return m.createElement("text",Object.assign({dominantBaseline:"central"},r),n)}return m.isValidElement(n)?n:null}function ce(e){var t=1e14;return Math.round((e+Number.EPSILON)*t)/t}function oe(e){var t=e.labelPosition,a=e.lineWidth,n=e.labelHorizontalShift,r=ce(n);if(r===0)return"middle";if(t>100)return r>0?"start":"end";var i=100-a;return t<i?r>0?"end":"start":"middle"}function se(e,t){return e.map(function(a,n){var r,i=(r=T(t.segmentsShift,n))!=null?r:0,o=E(t.radius,t.labelPosition)+i,c=$(K(a.startAngle,a.degrees),o),u=c.dx,g=c.dy,s={x:t.center[0],y:t.center[1],dx:u,dy:g,textAnchor:oe({labelPosition:t.labelPosition,lineWidth:t.lineWidth,labelHorizontalShift:u}),dataEntry:a,dataIndex:n,style:T(t.labelStyle,n)};return s})}function de(e,t){var a=t.label;if(a)return se(e,t).map(function(n,r){return m.createElement(le,{key:"label-"+(n.dataEntry.key||r),renderLabel:a,labelProps:n})})}var ue=function(t,a,n,r,i){var o=i-r;if(o===0)return[];var c=n*Math.cos(r)+t,u=n*Math.sin(r)+a,g=n*Math.cos(i)+t,s=n*Math.sin(i)+a,d=Math.abs(o)<=Math.PI?"0":"1",h=o<0?"0":"1";return[["M",c,u],["A",n,n,0,d,h,g,s]]},ge=ue,ve=ge;function fe(e,t,a,n,r){var i=N(n,-359.999,359.999);return ve(e,t,r,w(a),w(a+i)).map(function(o){return o.join(" ")}).join(" ")}function H(e){var t=e.cx,a=e.cy,n=e.lengthAngle,r=e.lineWidth,i=e.radius,o=e.shift,c=o===void 0?0:o,u=e.reveal,g=e.rounded,s=e.startAngle,d=e.title,h=X(e,["cx","cy","lengthAngle","lineWidth","radius","shift","reveal","rounded","startAngle","title"]),k=i-r/2,x=$(K(s,n),c),I=x.dx,A=x.dy,P=fe(t+I,a+A,s,n,k),y,W;if(q(u)){var G=w(k)*n;y=Math.abs(G),W=y-E(y,u)}return m.createElement("path",Object.assign({d:P,fill:"none",strokeWidth:r,strokeDasharray:y,strokeDashoffset:W,strokeLinecap:g?"round":void 0},h),d&&m.createElement("title",null,d))}function he(e,t,a){var n="stroke-dashoffset "+e+"ms "+t;return a&&a.transition&&(n=n+","+a.transition),{transition:n}}function me(e){return e.animate&&!q(e.reveal)?100:e.reveal}function C(e,t){return e&&function(a){e(a,t)}}function xe(e,t,a){var n=a??me(t),r=t.radius,i=t.center,o=i[0],c=i[1],u=E(r,t.lineWidth),g=e.map(function(s,d){var h=T(t.segmentsStyle,d);return m.createElement(H,{cx:o,cy:c,key:s.key||d,lengthAngle:s.degrees,lineWidth:u,radius:r,rounded:t.rounded,reveal:n,shift:T(t.segmentsShift,d),startAngle:s.startAngle,title:s.title,style:Object.assign({},h,t.animate&&he(t.animationDuration,t.animationEasing,h)),stroke:s.color,tabIndex:t.segmentsTabIndex,onBlur:C(t.onBlur,d),onClick:C(t.onClick,d),onFocus:C(t.onFocus,d),onKeyDown:C(t.onKeyDown,d),onMouseOver:C(t.onMouseOver,d),onMouseOut:C(t.onMouseOut,d)})});return t.background&&g.unshift(m.createElement(H,{cx:o,cy:c,key:"bg",lengthAngle:t.lengthAngle,lineWidth:u,radius:r,rounded:t.rounded,startAngle:t.startAngle,stroke:t.background})),g}var ye={animationDuration:500,animationEasing:"ease-out",center:[50,50],data:[],labelPosition:50,lengthAngle:360,lineWidth:100,paddingAngle:0,radius:50,startAngle:0,viewBoxSize:[100,100]};function Ce(e){var t=ne(e,ye),a=v.useState(t.animate?0:null),n=a[0],r=a[1];v.useEffect(function(){t.animate&&r(null)},[]);var i=ie(t);return m.createElement("svg",{viewBox:"0 0 "+t.viewBoxSize[0]+" "+t.viewBoxSize[1],width:"100%",height:"100%",className:t.className,style:t.style},xe(i,t,n),de(i,t),t.children)}function be(e){const t=D(e),[a,n]=v.useState(-1),i=v.useContext(S)!==M.Player||e.card.playerViewPermission===V.Interact,o=O("brand"),c=O("light-6"),u=O("brand-2");let g=[];for(let s=0;s<e.card.max;s++){let d=c;s<e.card.value&&(d=o),s===a&&(d=u),g.push({color:d,value:1})}return l.jsx(Ce,{data:g,onClick:i?(s,d)=>t(d):void 0,onMouseOver:i?(s,d)=>n(d):void 0,onMouseOut:()=>n(-1),startAngle:-90,segmentsShift:2,radius:48})}function ke(e){const{dispatch:t}=v.useContext(R),{card:a,setConfigurable:n}=e,r=v.useCallback(c=>t(j.SetClockValue({cardId:a.cardId,value:c})),[a.cardId,t]),i=v.useCallback(c=>t(j.SetClockMax({cardId:a.cardId,max:c})),[a.cardId,t]),o=v.useCallback(c=>{t(j.SetClockDisplayType({cardId:a.cardId,displayType:c})),n(!1)},[a.cardId,t,n]);return l.jsxs(f,{direction:"column",overflow:{vertical:"auto"},children:[l.jsxs(f,{direction:"row",align:"center",flex:"grow",children:[l.jsx(L,{label:"Current",children:l.jsx(z,{type:"number",defaultValue:a.value,onBlur:c=>r(parseInt(c.target.value))})}),l.jsx(L,{label:"Maximum",children:l.jsx(z,{type:"number",defaultValue:a.max,onBlur:c=>i(parseInt(c.target.value))})})]}),l.jsxs(f,{direction:"row",wrap:!0,align:"center",justify:"center",children:[l.jsx(b,{label:"Horizontal",active:a.displayType==="horizontal",onClick:()=>o("horizontal")}),l.jsx(b,{label:"Radial",active:a.displayType==="radial",onClick:()=>o("radial")}),l.jsx(b,{label:"Vertical Detail",active:a.displayType==="v-detail",onClick:()=>o("v-detail")})]})]})}const Y="50px";function je(e){const a=v.useContext(S)!==M.Player||e.card.playerViewPermission===V.Interact,n=D(e);let r=[];for(let i=0;i<e.card.max;i++)r.push(l.jsx(Ie,{detailIndex:i,card:e.card},e.card.cardId+"_"+i));return l.jsxs(f,{direction:"column",align:"flex-start",fill:"vertical",overflow:{vertical:"auto"},children:[a&&l.jsxs(f,{direction:"row",align:"center",children:[l.jsx(b,{plain:!0,margin:{vertical:"xsmall"},style:{textAlign:"center",width:Y},icon:l.jsx(B,{icon:F}),color:e.card.value===0?"light-6":"brand",onClick:()=>n(-1)}),l.jsx(U,{style:{fontStyle:"italic"},margin:"small",children:"Detail"})]}),l.jsx(f,{direction:"column",fill:!0,gap:"xxsmall",justify:"stretch",children:r})]})}function Ie(e){var g;const{dispatch:t}=v.useContext(R),n=v.useContext(S)!==M.Player||e.card.playerViewPermission===V.Interact,r=D(e),i=v.useCallback(s=>{t(j.SetClockDetail({cardId:e.card.cardId,detailIndex:e.detailIndex,detail:s.target.value}))},[t,e.card.cardId,e.detailIndex]),o=ee(i,200),c=e.detailIndex,u=c<e.card.value?"brand":"light-6";return l.jsxs(f,{direction:"row",flex:"grow",children:[l.jsx(f,{width:Y,flex:!1,hoverIndicator:n&&{color:"brand-2"},background:u,onClick:n?()=>r(c):void 0},c),l.jsx(f,{border:{color:u,size:"medium"},fill:!0,children:l.jsx(te,{resize:"vertical",defaultValue:(g=e.card.details)==null?void 0:g[c],onChange:s=>o(s)})})]})}function Ve(e){const[t,a]=v.useState(!1);let n=l.jsx(ae,{card:e.card});t?n=l.jsx(ke,{card:e.card,setConfigurable:a}):e.card.displayType==="radial"?n=l.jsx(be,{card:e.card}):e.card.displayType==="v-detail"&&(n=l.jsx(je,{card:e.card}));const r=J(e.card.cardId);return l.jsxs(Q,{cardState:e.card,commands:l.jsx(b,{"aria-label":"toggle-edit-mode",onClick:()=>a(!t),icon:l.jsx(B,{icon:t?_:p})}),children:[r&&l.jsx(Z,{level:"3",margin:{left:"2em",vertical:"xsmall"},children:e.card.title}),n]})}export{Ve as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MarkdownEditor-CGeF3IK3.js","assets/index-DsPVNeCc.js","assets/index-CbKTWGnK.css","assets/FirebaseUtils-HVElewoM.js","assets/tslib.es6-CDuPK5Eb.js","assets/cards-regular-BrObXIIZ.js","assets/CardLink-gG-maiwU.js","assets/Paragraph-CiA2wm3O.js","assets/Image-CjrAABXn.js","assets/Anchor-C5bMsW47.js","assets/Select-B2rWent2.js","assets/MarkdownEditor-BcXDEbgm.css"])))=>i.map(i=>d[i]);
import{R as c,j as t,f as C,r as f}from"./index-DsPVNeCc.js";import{R as x,C as p,V as w,h as v,P as h,M as j,B as d,b as u,F as m,aM as k,aN as E,aq as g,az as y}from"./FirebaseUtils-HVElewoM.js";import{u as T}from"./useThrottled-E5jSq4LR.js";import{T as b}from"./TextArea-C5OmfXwl.js";import{G as A,C as I}from"./CardLink-gG-maiwU.js";import"./Paragraph-CiA2wm3O.js";import"./Image-CjrAABXn.js";import"./Anchor-C5bMsW47.js";const M=c.lazy(()=>C(()=>import("./MarkdownEditor-CGeF3IK3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));function B(r){const{state:o,dispatch:a}=c.useContext(x),i=c.useCallback(e=>{const n=F(e,o.cardsById);a(p.SetCardContent({cardId:r.card.cardId,content:n}))},[r.card.cardId,o.cardsById,a]),s=T(i,200);return r.isMarkdownEditorActive?t.jsx(b,{fill:!0,autoFocus:!0,defaultValue:r.card.content,onChange:e=>{s(e.target.value)},style:{fontFamily:'"Roboto Mono", monospace'}}):t.jsx(M,{card:r.card,setContent:e=>{s(e)}})}function F(r,o){return r.replace(/\[\[([\w\d ]+)\]\]/g,(a,i)=>{const s=Object.values(o).find(e=>e.title.localeCompare(i)===0);return s?"["+i+"]("+s.cardId+")":a})}function G(r){const{card:o}=r,[a,i]=c.useState(!1),e=f.useContext(w)!==v.Player||o.playerViewPermission===h.Interact,[n,l]=c.useState(e&&o.content.length===0);return t.jsx(j,{cardState:o,commands:t.jsxs(t.Fragment,{children:[e&&n&&t.jsx(u,{"aria-label":"toggle-markdown-editing",onClick:()=>i(!a),icon:t.jsx(m,{icon:a?k:E}),tip:a?"Edit Formatted Text":"Edit Markdown Source"}),t.jsx(u,{"aria-label":"toggle-edit-mode",onClick:()=>e&&l(!n),icon:t.jsx(m,{icon:n?g:y}),tip:n?"Save":"Edit"})]}),children:n?t.jsx(d,{fill:!0,overflow:{vertical:"auto"},children:t.jsx(d,{flex:"grow",fill:a?"vertical":!1,style:{minHeight:a?0:"unset"},className:"article-card-content",children:t.jsx(B,{card:o,isMarkdownEditorActive:a})})}):t.jsx(d,{fill:!0,pad:"small",onDoubleClick:()=>e&&l(!0),overflow:{vertical:"auto"},children:t.jsx(A,{style:{whiteSpace:"pre-wrap"},components:{a:{component:I}},children:o.content.replace(/\\\n/g,`
`)})})})}export{G as default};

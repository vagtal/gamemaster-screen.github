import{r as i,j as t,a as d}from"./index-CW_PtJsW.js";import{R as g,u as j,H as N,B as b,a as p,G as h,b as w,F as S,f as M,c as k,g as m,r as f,o as v,d as P,e as D,D as A,T as L,V as R,h as T,i as E,j as F,E as I,k as x,p as U}from"./FirebaseUtils-CH2t-8ZB.js";import{u as B,C as O}from"./usePageTitle-BxSN4grl.js";import{u as V}from"./useUserIdFromActiveDashboard-BdvyNDjx.js";const C=i.createContext({name:null,setName:()=>{}});function H(e){const[s,r]=i.useState("offline");return i.useEffect(()=>{const n=m(d);if(e){const o=f(n,`status/${e}`);return v(o,a=>{r(a.val())}),()=>P(o)}},[e]),s}const W=e=>{var l,c;const{state:s}=i.useContext(g),r=j(),n=V(),a=H(n)==="offline"?" [Offline]":"";return t.jsxs(N,{fill:!0,background:"brand",pad:{left:"10px",right:"10px"},gap:"none",direction:"row",height:"xsmall",children:[t.jsxs(b,{align:"center",direction:"row",fill:!0,style:{whiteSpace:"nowrap"},children:[t.jsx(p,{level:1,size:"small",margin:"none",title:(l=h(s,r))==null?void 0:l.name,children:(c=h(s,r))==null?void 0:c.name}),t.jsxs(p,{level:2,size:"small",margin:{left:"10px"},title:"Paragon Campaign Dashboard: Player View"+a,style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:["Paragon Campaign Dashboard: Player View",a]})]}),t.jsx($,{}),t.jsx(w,{onClick:()=>e.setMatchGMLayout(!e.matchGMLayout),icon:t.jsx(S,{fixedWidth:!0,icon:e.matchGMLayout?M:k}),tip:e.matchGMLayout?"Matching GM layout":"Unlocked from GM layout"})]})};function $(){const[e,s]=i.useState(!1),r=i.useRef(null),n=i.useContext(C);return t.jsxs(t.Fragment,{children:[t.jsx(w,{onClick:()=>s(!e),icon:t.jsx(S,{fixedWidth:!0,icon:D}),tip:"Set Player Name",ref:r}),r.current&&e&&t.jsx(A,{target:r.current,align:{top:"bottom"},onClickOutside:()=>s(!1),children:t.jsx(L,{placeholder:"Player Name",defaultValue:n.name??void 0,onKeyDown:o=>{if(o.key!=="Enter")return;const a=o.target;a.value.length>0&&(n.setName(a.value),s(!1))}})})]})}function y(e,s){const[r,n]=i.useState(()=>{const a=localStorage.getItem(e);return a?JSON.parse(a):s});return[r,a=>{n(a),localStorage.setItem(e,JSON.stringify(a))}]}function z(e){const[s,r]=i.useState(I()),n=j();return i.useEffect(()=>{if(!e)return;const a=m(d),l=f(a,`users/${e}/playerViews/${n}`);return v(l,c=>{const u=c.val();if(!u)return;const G=x.restorePrunedEmptyArrays(u);r(G)}),()=>{P(l)}},[n,e]),[s,a=>{const l=x.removeUndefinedNodesFromTree(a),c=m(d),u=f(c,`pendingActions/${n}`);U(u,l)}]}function X(){const e=V(),[s,r]=z(e),[n,o]=y("matchGmLayout",!0),[a,l]=y("playerName",null);return B(s),t.jsx(g.Provider,{value:{state:s,dispatch:r},children:t.jsx(R.Provider,{value:T.Player,children:t.jsx(C.Provider,{value:{name:a,setName:l},children:t.jsx(E,{style:{minHeight:"100%"},theme:F,children:t.jsxs(b,{fill:!0,align:"center",children:[t.jsx(W,{matchGMLayout:n,setMatchGMLayout:o}),t.jsx(O,{matchGMLayout:n,setMatchGMLayout:o})]})})})})})}export{X as default};

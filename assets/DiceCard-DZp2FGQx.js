import{r as w,R as Lt,j as _}from"./index-0mFGPIzu.js";import{c as Gt}from"./_commonjs-dynamic-modules-TDtrdbi3.js";import{O as dt,a5 as Bt,$ as Ut,aP as $t,a3 as q,Z as Ie,aY as pt,Y as A,aZ as S,a_ as Vt,S as Wt,a$ as Kt,W as zt,N as P,B as F,F as B,b0 as Ht,b as U,b1 as Zt,T as vt,R as gt,M as yt,C as oe,b2 as Qt,aq as Yt,V as Xt,h as Se,P as Jt,aV as er,_ as tr}from"./FirebaseUtils-Bz9HKAc4.js";import{u as rr}from"./useScrollTo-BE6JveLo.js";import{P as nr}from"./PlayerViewUserContext-Ckiu1h0x.js";import{T as ir}from"./TextArea-ycmFWjgz.js";var qe=function(e,a){return e.theme.rangeInput&&e.theme.rangeInput.track&&e.theme.rangeInput.track[a]&&e.theme.rangeInput.track[a].opacity?e.theme.rangeInput.track[a].opacity:1},Me=function(e,a){return e.theme.rangeInput&&e.theme.rangeInput.track&&e.theme.rangeInput.track[a]&&e.theme.rangeInput.track[a].color?S(A(e.theme.rangeInput.track[a].color,e.theme),qe(e,a)):S(A(e.theme.rangeInput.track.color,e.theme),qe(e,a))},xe=function(e){var a,n,h=e.max,i=e.min,v=((e.value||0)-i)/(h-i)*100+"%",p;if(e.theme.rangeInput&&e.theme.rangeInput.track&&!e.theme.rangeInput.track.lower&&!e.theme.rangeInput.track.upper){var o=S(A(e.theme.rangeInput.track.color,e.theme),.2);if(o==="rgba(0, 0, 0, 0.2)"?p=o:p=S(A(e.theme.rangeInput.track.color,e.theme),e.theme.rangeInput.track.opacity||1),!e.color)return"background: "+p}var c=(a=e.theme.rangeInput.track)!=null&&a.upper?Me(e,"upper"):p,f=(n=e.theme.rangeInput.track)!=null&&n.lower?Me(e,"lower"):S(A(e.theme.global.colors.control,e.theme),e.theme.rangeInput.track.opacity||1);if(typeof e.color=="string"||typeof e.color=="object"&&!Array.isArray(e.color))return f=A(e.color,e.theme),`background: linear-gradient(
        to right,
        `+f+`,
        `+f+" "+v+`,
        `+c+" "+v+`,
        `+c+`
      );
    `;if(Array.isArray(e.color)){for(var s=e.color,l=0,r="background: linear-gradient(to right,",u=0;u<s.length;u+=1){var d=s[u],y=d.value,b=d.color,g=d.opacity;if(r+=S(A(b,e.theme),g||1)+" "+l+"%,",e.value>=y)l=(y-i)/(h-i)*100,r+=S(A(b,e.theme),g||1)+" "+l+"%,";else{r+=S(A(b,e.theme),g||1)+" "+v+",",r+=c+" "+v+", "+c+")";break}u===s.length-1&&(r+=c+" "+l+"%, "+c+")")}return r}return`background: linear-gradient(
      to right,
      `+f+`,
      `+f+" "+v+`,
      `+c+" "+v+`,
      `+c+`
    );
  `},bt=function(e,a){var n;return q([""," ",""],Vt(e.theme.rangeInput.disabled.opacity),((n=e.theme.rangeInput.disabled[a])==null?void 0:n.color)&&"background: "+A(e.theme.rangeInput.disabled[a].color,e.theme)+";")},V=function(e){return q(["box-shadow:0px 0px 0px 2px ",";"],A(e.theme.rangeInput.thumb.color||"control",e.theme))},fe=q(["box-sizing:border-box;width:100%;height:",";",";"," ",";"],function(t){return t.theme.rangeInput.track.height},function(t){return xe(t)},function(t){return t.theme.rangeInput&&t.theme.rangeInput.track&&t.theme.rangeInput.track.extend},function(t){var e;return t.disabled&&((e=t.theme)==null||(e=e.rangeInput)==null?void 0:e.disabled)&&bt(t,"track")}),kt=q(["box-sizing:border-box;position:relative;border-radius:",";height:",";width:",";overflow:visible;background:",";-webkit-appearance:none;cursor:pointer;"," ",";"],function(t){return t.theme.global.spacing},function(t){return t.theme.global.spacing},function(t){return t.theme.global.spacing},function(t){return A(t.theme.rangeInput.thumb.color||"control",t.theme)},function(t){return t.theme.rangeInput&&t.theme.rangeInput.thumb&&t.theme.rangeInput.thumb.extend},function(t){var e;return t.disabled&&((e=t.theme)==null||(e=e.rangeInput)==null?void 0:e.disabled)&&bt(t,"thumb")}),Pe=q([""," margin-top:0px;height:",";width:",";"," ",""],kt,function(t){return t.theme.global.spacing},function(t){return t.theme.global.spacing},function(t){return t.focus&&t.focusIndicator&&pt()},function(t){return t.theme.rangeInput&&t.theme.rangeInput.thumb&&t.theme.rangeInput.thumb.extend}),ar=dt.input.withConfig(Bt).attrs(Ut).withConfig({displayName:"StyledRangeInput",componentId:"sc-15st9ck-0"})(["box-sizing:border-box;position:relative;-webkit-appearance:none;border-color:transparent;height:",";width:100%;padding:0px;cursor:",";background:transparent;margin:0px;"," &::-moz-focus-inner{border:none;}&::-moz-focus-outer{border:none;}&::-webkit-slider-runnable-track{","}&::-webkit-slider-thumb{margin-top:-","px;"," "," ","}&::-moz-range-track{","}&::-moz-range-thumb{","}&::-ms-thumb{","}"," &::-ms-track{"," border-color:transparent;color:transparent;}&::-ms-fill-lower{",";border-color:transparent;}&::-ms-fill-upper{",";border-color:transparent;}&:focus::-webkit-slider-thumb{","}&:focus-visible{outline:0;}&:focus{outline:none;}",""],function(t){return t.theme.global.spacing},function(t){return t.disabled?"default":"pointer"},function(t){return t.theme.rangeInput.pad&&$t("padding",t.theme.rangeInput.pad,t.responsive,t.theme.box.responsiveBreakpoint,t.theme)},fe,function(t){return(Ie(t.theme.global.spacing)-Ie(t.theme.rangeInput.track.height||0))*.5},kt,function(t){return!t.disabled&&q(["&:hover{","}"],V(t))},function(t){return t.focus&&!t.focusIndicator&&q(["",""],V(t))},fe,Pe,Pe,function(t){return!t.disabled&&q(["&:hover::-moz-range-thumb{","}&:hover::-ms-thumb{","}"],V(t),V(t))},fe,function(t){return xe(t)},function(t){return xe(t)},function(t){return t.focus&&t.focusIndicator&&pt()},function(t){return t.theme.rangeInput&&t.theme.rangeInput.extend}),ur={},or=ur,cr=["a11yTitle","color","focus","focusIndicator","name","onChange","onFocus","onBlur","value","step","min","max"];function Te(){return Te=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)({}).hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},Te.apply(null,arguments)}function sr(t,e){if(t==null)return{};var a={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.includes(n))continue;a[n]=t[n]}return a}var we=w.forwardRef(function(t,e){var a,n=t.a11yTitle,h=t.color,i=t.focus,v=t.focusIndicator,p=v===void 0?!0:v,o=t.name,c=t.onChange,f=t.onFocus,s=t.onBlur,l=t.value,r=t.step,u=r===void 0?1:r,d=t.min,y=d===void 0?0:d,b=t.max,g=b===void 0?100:b,C=sr(t,cr),x=Wt(),E=w.useContext(Kt),k=w.useState(i),m=k[0],T=k[1],N=(x==null||(a=x.rangeInput)==null?void 0:a.wheel)!==!1,O=E.useFormInput({name:o,value:l}),I=O[0],Mt=O[1],Re=w.useState({x:null,y:null}),le=Re[0],Ae=Re[1],$=zt(e);w.useEffect(function(){var R=le.x,D=le.y,M=function(){return window.scrollTo(R,D)};return R!==null&&D!==null&&N&&window.addEventListener("scroll",M),function(){window.removeEventListener("scroll",M)}},[le,N]);var Oe=w.useCallback(function(R){if(!(R>g||R<y)){var D=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;D.call($.current,R);var M=new Event("input",{bubbles:!0});$.current.dispatchEvent(M)}},[$,y,g]),Pt=function(D){var M=parseFloat(I);D.deltaY<0?Oe(M+u):Oe(M-u)},Ft=function(){return Ae({x:window.scrollX,y:window.scrollY})},jt=function(){return Ae({x:null,y:null})};return Lt.createElement(ar,Te({"aria-label":n,"aria-valuemax":g,"aria-valuemin":y,"aria-valuenow":I,ref:$,name:o,focus:m,focusIndicator:p,value:I||I===0?I:""},C,{color:h,onFocus:function(D){T(!0),f&&f(D)},onBlur:function(D){T(!1),s&&s(D)},onChange:function(D){Mt(D.target.value),c&&c(D)},onMouseOver:N?Ft:void 0,onMouseOut:N?jt:void 0,onWheel:N?Pt:void 0,step:u,type:"range",min:y,max:g}))});we.displayName="RangeInput";we.propTypes=or;var he={},de={},W={},K={},Fe;function Ct(){if(Fe)return K;Fe=1,Object.defineProperty(K,"__esModule",{value:!0});var t=xt(),e=function(){function a(){}return a.create=function(n){return new t.ExpressionNode(n)},a}();return K.Factory=e,K}var z={},je;function mt(){if(je)return z;je=1,Object.defineProperty(z,"__esModule",{value:!0});var t=function(){function e(){}return e}();return z.NodeAttributes=t,z}var Le;function xt(){if(Le)return W;Le=1,Object.defineProperty(W,"__esModule",{value:!0});var t=Ct(),e=mt(),a=function(){function n(h,i){i===void 0&&(i=null),this.type=h,this.parent=i}return n.prototype.copy=function(){var h=this,i=t.Factory.create(this.type);return this.attributes&&Object.keys(this.attributes).forEach(function(v){i.setAttribute(v,h.attributes[v])}),this.children&&this.children.forEach(function(v){i.addChild(v.copy())}),i},n.prototype.addChild=function(h){return this.insertChild(h)},n.prototype.insertChild=function(h,i){if(h){if(h===this)throw new Error("Cannot add a node as a child of itself.");this.children||(this.children=[]),this.children.splice(i||this.children.length,0,h),h.parent=this}return h},n.prototype.clearChildren=function(){this.children=void 0},n.prototype.removeChild=function(h){return h.parent!==this?null:(this.children.splice(this.children.indexOf(h,1)),h)},n.prototype.getParent=function(){return this.parent},n.prototype.getChild=function(h){if(!this.children||this.children.length<=h)throw new Error("Child node at index "+h+" does not exist.");return this.children[h]},n.prototype.getChildCount=function(){return this.children?this.children.length:0},n.prototype.forEachChild=function(h){var i=(this.children||[]).slice();i.forEach(h)},n.prototype.getAttribute=function(h){return this.attributes?this.attributes[h]:void 0},n.prototype.setAttribute=function(h,i){return this.attributes||(this.attributes=new e.NodeAttributes),this.attributes[h]=i,this},n.prototype.toJSON=function(){var h=this,i=Object.keys(this).filter(function(p){return p!=="parent"}),v={};return i.forEach(function(p){return v[p]=h[p]}),v},n}();return W.ExpressionNode=a,W}var pe={},Ge;function lr(){return Ge||(Ge=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Function="Function"]="Function",e[e.Group="Group"]="Group",e[e.Repeat="Repeat"]="Repeat",e[e.Add="Add"]="Add",e[e.Subtract="Subtract"]="Subtract",e[e.Negate="Negate"]="Negate",e[e.Exponent="Exponent"]="Exponent",e[e.Multiply="Multiply"]="Multiply",e[e.Divide="Divide"]="Divide",e[e.Modulo="Modulo"]="Modulo",e[e.Equal="Equal"]="Equal",e[e.Greater="Greater"]="Greater",e[e.GreaterOrEqual="GreaterOrEqual"]="GreaterOrEqual",e[e.Less="Less"]="Less",e[e.LessOrEqual="LessOrEqual"]="LessOrEqual",e[e.Explode="Explode"]="Explode",e[e.Keep="Keep"]="Keep",e[e.Drop="Drop"]="Drop",e[e.Critical="Critical"]="Critical",e[e.Reroll="Reroll"]="Reroll",e[e.Sort="Sort"]="Sort",e[e.Dice="Dice"]="Dice",e[e.DiceSides="DiceSides"]="DiceSides",e[e.DiceRoll="DiceRoll"]="DiceRoll",e[e.Number="Number"]="Number"}(t.NodeType||(t.NodeType={}))}(pe)),pe}var Be;function se(){return Be||(Be=1,function(t){function e(a){for(var n in a)t.hasOwnProperty(n)||(t[n]=a[n])}Object.defineProperty(t,"__esModule",{value:!0}),e(xt()),e(Ct()),e(mt()),e(lr())}(de)),de}var ve={},H={},ce={exports:{}},fr=ce.exports,Ue;function hr(){return Ue||(Ue=1,function(t){(function(e){var a="Random",n=typeof Math.imul!="function"||Math.imul(4294967295,5)!==-5?function(r,u){var d=r>>>16&65535,y=r&65535,b=u>>>16&65535,g=u&65535;return y*g+(d*g+y*b<<16>>>0)|0}:Math.imul,h=typeof String.prototype.repeat=="function"&&"x".repeat(3)==="xxx"?function(r,u){return r.repeat(u)}:function(r,u){for(var d="";u>0;)u&1&&(d+=r),u>>=1,r+=r;return d};function i(r){if(!(this instanceof i))return new i(r);if(r==null)r=i.engines.nativeMath;else if(typeof r!="function")throw new TypeError("Expected engine to be a function, got "+typeof r);this.engine=r}var v=i.prototype;i.engines={nativeMath:function(){return Math.random()*4294967296|0},mt19937:function(r){function u(g){for(var C=0,x=0;(C|0)<227;C=C+1|0)x=g[C]&2147483648|g[C+1|0]&2147483647,g[C]=g[C+397|0]^x>>>1^(x&1?2567483615:0);for(;(C|0)<623;C=C+1|0)x=g[C]&2147483648|g[C+1|0]&2147483647,g[C]=g[C-227|0]^x>>>1^(x&1?2567483615:0);x=g[623]&2147483648|g[0]&2147483647,g[623]=g[396]^x>>>1^(x&1?2567483615:0)}function d(g){return g^=g>>>11,g^=g<<7&2636928640,g^=g<<15&4022730752,g^g>>>18}function y(g,C){for(var x=1,E=0,k=C.length,m=Math.max(k,624)|0,T=g[0]|0;(m|0)>0;--m)g[x]=T=(g[x]^n(T^T>>>30,1664525))+(C[E]|0)+(E|0)|0,x=x+1|0,++E,(x|0)>623&&(g[0]=g[623],x=1),E>=k&&(E=0);for(m=623;(m|0)>0;--m)g[x]=T=(g[x]^n(T^T>>>30,1566083941))-x|0,x=x+1|0,(x|0)>623&&(g[0]=g[623],x=1);g[0]=2147483648}function b(){var g=new r(624),C=0,x=0;function E(){(C|0)>=624&&(u(g),C=0);var k=g[C];return C=C+1|0,x+=1,d(k)|0}return E.getUseCount=function(){return x},E.discard=function(k){for(x+=k,(C|0)>=624&&(u(g),C=0);k-C>624;)k-=624-C,u(g),C=0;return C=C+k|0,E},E.seed=function(k){var m=0;g[0]=m=k|0;for(var T=1;T<624;T=T+1|0)g[T]=m=n(m^m>>>30,1812433253)+T|0;return C=624,x=0,E},E.seedWithArray=function(k){return E.seed(19650218),y(g,k),E},E.autoSeed=function(){return E.seedWithArray(i.generateEntropyArray())},E}return b}(typeof Int32Array=="function"?Int32Array:Array),browserCrypto:typeof crypto<"u"&&typeof crypto.getRandomValues=="function"&&typeof Int32Array=="function"?function(){var r=null,u=128;return function(){return u>=128&&(r===null&&(r=new Int32Array(128)),crypto.getRandomValues(r),u=0),r[u++]|0}}():null},i.generateEntropyArray=function(){for(var r=[],u=i.engines.nativeMath,d=0;d<16;++d)r[d]=u()|0;return r.push(new Date().getTime()|0),r};function p(r){return function(){return r}}i.int32=function(r){return r()|0},v.int32=function(){return i.int32(this.engine)},i.uint32=function(r){return r()>>>0},v.uint32=function(){return i.uint32(this.engine)},i.uint53=function(r){var u=r()&2097151,d=r()>>>0;return u*4294967296+d},v.uint53=function(){return i.uint53(this.engine)},i.uint53Full=function(r){for(;;){var u=r()|0;if(u&2097152){if((u&4194303)===2097152&&(r()|0)===0)return 9007199254740992}else{var d=r()>>>0;return(u&2097151)*4294967296+d}}},v.uint53Full=function(){return i.uint53Full(this.engine)},i.int53=function(r){var u=r()|0,d=r()>>>0;return(u&2097151)*4294967296+d+(u&2097152?-9007199254740992:0)},v.int53=function(){return i.int53(this.engine)},i.int53Full=function(r){for(;;){var u=r()|0;if(u&4194304){if((u&8388607)===4194304&&(r()|0)===0)return 9007199254740992}else{var d=r()>>>0;return(u&2097151)*4294967296+d+(u&2097152?-9007199254740992:0)}}},v.int53Full=function(){return i.int53Full(this.engine)};function o(r,u){return u===0?r:function(d){return r(d)+u}}i.integer=function(){function r(k){return(k+1&k)===0}function u(k){return function(m){return m()&k}}function d(k){var m=k+1,T=m*Math.floor(4294967296/m);return function(N){var O=0;do O=N()>>>0;while(O>=T);return O%m}}function y(k){return r(k)?u(k):d(k)}function b(k){return(k|0)===0}function g(k){return function(m){var T=m()&k,N=m()>>>0;return T*4294967296+N}}function C(k){var m=k*Math.floor(9007199254740992/k);return function(T){var N=0;do{var O=T()&2097151,I=T()>>>0;N=O*4294967296+I}while(N>=m);return N%k}}function x(k){var m=k+1;if(b(m)){var T=(m/4294967296|0)-1;if(r(T))return g(T)}return C(m)}function E(k,m){return function(T){var N=0;do{var O=T()|0,I=T()>>>0;N=(O&2097151)*4294967296+I+(O&2097152?-9007199254740992:0)}while(N<k||N>m);return N}}return function(k,m){if(k=Math.floor(k),m=Math.floor(m),k<-9007199254740992||!isFinite(k))throw new RangeError("Expected min to be at least "+-9007199254740992);if(m>9007199254740992||!isFinite(m))throw new RangeError("Expected max to be at most "+9007199254740992);var T=m-k;return T<=0||!isFinite(T)?p(k):T===4294967295?k===0?i.uint32:o(i.int32,k+2147483648):T<4294967295?o(y(T),k):T===9007199254740991?o(i.uint53,k):T<9007199254740991?o(x(T),k):m-1-k===9007199254740991?o(i.uint53Full,k):k===-9007199254740992&&m===9007199254740992?i.int53Full:k===-9007199254740992&&m===9007199254740991?i.int53:k===-9007199254740991&&m===9007199254740992?o(i.int53,1):m===9007199254740992?o(E(k-1,m-1),1):E(k,m)}}(),v.integer=function(r,u){return i.integer(r,u)(this.engine)},i.realZeroToOneInclusive=function(r){return i.uint53Full(r)/9007199254740992},v.realZeroToOneInclusive=function(){return i.realZeroToOneInclusive(this.engine)},i.realZeroToOneExclusive=function(r){return i.uint53(r)/9007199254740992},v.realZeroToOneExclusive=function(){return i.realZeroToOneExclusive(this.engine)},i.real=function(){function r(u,d){return d===1?u:d===0?function(){return 0}:function(y){return u(y)*d}}return function(u,d,y){if(isFinite(u)){if(!isFinite(d))throw new RangeError("Expected right to be a finite number")}else throw new RangeError("Expected left to be a finite number");return o(r(y?i.realZeroToOneInclusive:i.realZeroToOneExclusive,d-u),u)}}(),v.real=function(r,u,d){return i.real(r,u,d)(this.engine)},i.bool=function(){function r(y){return(y()&1)===1}function u(y,b){return function(g){return y(g)<b}}function d(y){if(y<=0)return p(!1);if(y>=1)return p(!0);var b=y*4294967296;return b%1===0?u(i.int32,b-2147483648|0):u(i.uint53,Math.round(y*9007199254740992))}return function(y,b){return b==null?y==null?r:d(y):y<=0?p(!1):y>=b?p(!0):u(i.integer(0,b-1),y)}}(),v.bool=function(r,u){return i.bool(r,u)(this.engine)};function c(r){var u=+r;return u<0?Math.ceil(u):Math.floor(u)}function f(r,u){return r<0?Math.max(r+u,0):Math.min(r,u)}i.pick=function(r,u,d,y){var b=u.length,g=d==null?0:f(c(d),b),C=y===void 0?b:f(c(y),b);if(!(g>=C)){var x=i.integer(g,C-1);return u[x(r)]}},v.pick=function(r,u,d){return i.pick(this.engine,r,u,d)};function s(){}var l=Array.prototype.slice;i.picker=function(r,u,d){var y=l.call(r,u,d);if(!y.length)return s;var b=i.integer(0,y.length-1);return function(g){return y[b(g)]}},i.shuffle=function(r,u,d){var y=u.length;if(y){d==null&&(d=0);for(var b=y-1>>>0;b>d;--b){var g=i.integer(0,b),C=g(r);if(b!==C){var x=u[b];u[b]=u[C],u[C]=x}}}return u},v.shuffle=function(r){return i.shuffle(this.engine,r)},i.sample=function(r,u,d){if(d<0||d>u.length||!isFinite(d))throw new RangeError("Expected sampleSize to be within 0 and the length of the population");if(d===0)return[];var y=l.call(u),b=y.length;if(b===d)return i.shuffle(r,y,0);var g=b-d;return i.shuffle(r,y,g-1).slice(g)},v.sample=function(r,u){return i.sample(this.engine,r,u)},i.die=function(r){return i.integer(1,r)},v.die=function(r){return i.die(r)(this.engine)},i.dice=function(r,u){var d=i.die(r);return function(y){var b=[];b.length=u;for(var g=0;g<u;++g)b[g]=d(y);return b}},v.dice=function(r,u){return i.dice(r,u)(this.engine)},i.uuid4=function(){function r(u,d){return h("0",d-u.length)+u}return function(u){var d=u()>>>0,y=u()|0,b=u()|0,g=u()>>>0;return r(d.toString(16),8)+"-"+r((y&65535).toString(16),4)+"-"+r((y>>4&4095|16384).toString(16),4)+"-"+r((b&16383|32768).toString(16),4)+"-"+r((b>>4&65535).toString(16),4)+r(g.toString(16),8)}}(),v.uuid4=function(){return i.uuid4(this.engine)},i.string=function(){var r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-";return function(u){u==null&&(u=r);var d=u.length;if(!d)throw new Error("Expected pool not to be an empty string");var y=i.integer(0,d-1);return function(b,g){for(var C="",x=0;x<g;++x){var E=y(b);C+=u.charAt(E)}return C}}}(),v.string=function(r,u){return i.string(u)(this.engine,r)},i.hex=function(){var r="0123456789abcdef",u=i.string(r),d=i.string(r.toUpperCase());return function(y){return y?d:u}}(),v.hex=function(r,u){return i.hex(u)(this.engine,r)},i.date=function(r,u){if(r instanceof Date){if(!(u instanceof Date))throw new TypeError("Expected end to be a Date, got "+typeof u)}else throw new TypeError("Expected start to be a Date, got "+typeof r);var d=i.integer(r.getTime(),u.getTime());return function(y){return new Date(d(y))}},v.date=function(r,u){return i.date(r,u)(this.engine)},typeof Gt=="function"?t.exports=i:(function(){var r=e[a];i.noConflict=function(){return e[a]=r,this}}(),e[a]=i)})(fr)}(ce)),ce.exports}var $e;function dr(){if($e)return H;$e=1,Object.defineProperty(H,"__esModule",{value:!0});var t=hr(),e=function(){function a(){this.random=new t(t.engines.mt19937().autoSeed())}return a.prototype.numberBetween=function(n,h){return this.random.integer(n,h)},a}();return H.DefaultRandomProvider=e,H}var Ve;function Tt(){return Ve||(Ve=1,function(t){function e(a){for(var n in a)t.hasOwnProperty(n)||(t[n]=a[n])}Object.defineProperty(t,"__esModule",{value:!0}),e(dr())}(ve)),ve}var ge={},Z={},We;function pr(){if(We)return Z;We=1,Object.defineProperty(Z,"__esModule",{value:!0});var t=se(),e=function(){function a(){}return a.prototype.generate=function(n){switch(n.type){case t.NodeType.Number:return this.generateNumber(n);case t.NodeType.Add:return this.generateAdd(n);case t.NodeType.Subtract:return this.generateSubtract(n);case t.NodeType.Multiply:return this.generateMultiply(n);case t.NodeType.Divide:return this.generateDivide(n);case t.NodeType.Modulo:return this.generateModulo(n);case t.NodeType.Exponent:return this.generateExponent(n);case t.NodeType.Negate:return this.generateNegate(n);case t.NodeType.Dice:return this.generateDice(n);case t.NodeType.DiceSides:return this.generateDiceSides(n);case t.NodeType.DiceRoll:return this.generateDiceRoll(n);case t.NodeType.Function:return this.generateFunction(n);case t.NodeType.Group:return this.generateGroup(n);case t.NodeType.Repeat:return this.generateRepeat(n);case t.NodeType.Equal:return this.generateEqual(n);case t.NodeType.Greater:return this.generateGreater(n);case t.NodeType.GreaterOrEqual:return this.generateGreaterOrEqual(n);case t.NodeType.Less:return this.generateLess(n);case t.NodeType.LessOrEqual:return this.generateLessOrEqual(n);case t.NodeType.Explode:return this.generateExplode(n);case t.NodeType.Keep:return this.generateKeep(n);case t.NodeType.Drop:return this.generateDrop(n);case t.NodeType.Critical:return this.generateCritical(n);case t.NodeType.Reroll:return this.generateReroll(n);case t.NodeType.Sort:return this.generateSort(n);default:throw new Error("Unrecognized node type.")}},a.prototype.generateNumber=function(n){return n.getAttribute("value").toString()},a.prototype.generateAdd=function(n){return this.expectChildCount(n,2),this.generate(n.getChild(0))+" + "+this.generate(n.getChild(1))},a.prototype.generateSubtract=function(n){return this.expectChildCount(n,2),this.generate(n.getChild(0))+" - "+this.generate(n.getChild(1))},a.prototype.generateMultiply=function(n){return this.expectChildCount(n,2),this.generate(n.getChild(0))+" * "+this.generate(n.getChild(1))},a.prototype.generateDivide=function(n){return this.expectChildCount(n,2),this.generate(n.getChild(0))+" / "+this.generate(n.getChild(1))},a.prototype.generateModulo=function(n){return this.expectChildCount(n,2),this.generate(n.getChild(0))+" % "+this.generate(n.getChild(1))},a.prototype.generateExponent=function(n){return this.expectChildCount(n,2),this.generate(n.getChild(0))+" ^ "+this.generate(n.getChild(1))},a.prototype.generateNegate=function(n){return this.expectChildCount(n,1),"-"+this.generate(n.getChild(0))},a.prototype.generateDice=function(n){return n.getChildCount()===0||n.getChild(0).type===t.NodeType.DiceRoll?"["+this.generateCommaList(n)+"]":(this.expectChildCount(n,2),this.generateWithParens(n.getChild(0))+"d"+this.generateWithParens(n.getChild(1)))},a.prototype.generateDiceSides=function(n){var h=n.getAttribute("value").toString();return h==="fate"?"F":h},a.prototype.generateDiceRoll=function(n){return n.getAttribute("value").toString()},a.prototype.generateFunction=function(n){return n.getAttribute("name")+"("+this.generateCommaList(n)+")"},a.prototype.generateGroup=function(n){return"{"+this.generateCommaList(n)+"}"},a.prototype.generateRepeat=function(n){return this.expectChildCount(n,2),this.generate(n.getChild(0))+"..."+this.generate(n.getChild(1))},a.prototype.generateEqual=function(n){return this.generateEqualityExpression(n,"=")},a.prototype.generateGreater=function(n){return this.generateEqualityExpression(n,">")},a.prototype.generateGreaterOrEqual=function(n){return this.generateEqualityExpression(n,">=")},a.prototype.generateLess=function(n){return this.generateEqualityExpression(n,"<")},a.prototype.generateLessOrEqual=function(n){return this.generateEqualityExpression(n,"<=")},a.prototype.generateExplode=function(n){this.expectChildCount(n,1);var h="!";return n.getAttribute("compound")&&(h+="!"),n.getAttribute("penetrate")&&(h+="p"),n.getChildCount()>1&&(h+=this.generate(n.getChild(1))),this.generate(n.getChild(0))+h},a.prototype.generateKeep=function(n){this.expectChildCount(n,1);var h="k";return n.getAttribute("type")==="highest"&&(h+="h"),n.getAttribute("type")==="lowest"&&(h+="l"),n.getChildCount()>1&&(h+=this.generate(n.getChild(1))),this.generate(n.getChild(0))+h},a.prototype.generateDrop=function(n){this.expectChildCount(n,1);var h="d";return n.getAttribute("type")==="highest"&&(h+="h"),n.getAttribute("type")==="lowest"&&(h+="l"),n.getChildCount()>1&&(h+=this.generate(n.getChild(1))),this.generate(n.getChild(0))+h},a.prototype.generateCritical=function(n){this.expectChildCount(n,1);var h="c";return n.getAttribute("type")==="success"&&(h+="s"),n.getAttribute("type")==="failure"&&(h+="f"),n.getChildCount()>1&&(h+=this.generate(n.getChild(1))),this.generate(n.getChild(0))+h},a.prototype.generateReroll=function(n){this.expectChildCount(n,1);var h="r";return n.getAttribute("once")&&(h+="o"),n.getChildCount()>1&&(h+=this.generate(n.getChild(1))),this.generate(n.getChild(0))+h},a.prototype.generateSort=function(n){this.expectChildCount(n,1);var h="s";return n.getAttribute("direction")==="ascending"&&(h+="a"),n.getAttribute("direction")==="descending"&&(h+="d"),this.generate(n.getChild(0))+h},a.prototype.generateEqualityExpression=function(n,h){return this.expectChildCount(n,1),n.getChildCount()===1?h+this.generate(n.getChild(0)):this.generate(n.getChild(0))+" "+h+" "+this.generate(n.getChild(1))},a.prototype.generateCommaList=function(n){for(var h="",i=0;i<n.getChildCount();i++)i>0&&(h+=", "),h+=this.generate(n.getChild(i));return h},a.prototype.generateWithParens=function(n){return n.getChildCount()===0?this.generate(n):"("+this.generate(n)+")"},a.prototype.expectChildCount=function(n,h){var i=n.getChildCount();if(i<h)throw new Error("Expected "+n.type+" node to have "+h+" children, but found "+i+".")},a}();return Z.DiceGenerator=e,Z}var Ke;function De(){return Ke||(Ke=1,function(t){function e(a){for(var n in a)t.hasOwnProperty(n)||(t[n]=a[n])}Object.defineProperty(t,"__esModule",{value:!0}),e(pr())}(ge)),ge}var ye={},j={},Q={},ze;function vr(){if(ze)return Q;ze=1,Object.defineProperty(Q,"__esModule",{value:!0});var t=function(){function e(a,n,h){this.reducedExpression=a,this.renderedExpression=n,this.total=h}return e}();return Q.Result=t,Q}var He;function _e(){if(He)return j;He=1;var t=j&&j.__extends||function(){var n=function(h,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,p){v.__proto__=p}||function(v,p){for(var o in p)p.hasOwnProperty(o)&&(v[o]=p[o])},n(h,i)};return function(h,i){n(h,i);function v(){this.constructor=h}h.prototype=i===null?Object.create(i):(v.prototype=i.prototype,new v)}}();Object.defineProperty(j,"__esModule",{value:!0});var e=vr(),a=function(n){t(h,n);function h(i,v,p,o,c,f){var s=n.call(this,i,v,p)||this;return s.successes=o,s.failures=c,s.errors=f,s}return h}(e.Result);return j.DiceResult=a,j}var Y={},be={},X={},Ze;function Ee(){if(Ze)return X;Ze=1,Object.defineProperty(X,"__esModule",{value:!0});var t=function(){function e(){}return e}();return X.FunctionDefinitionList=t,X}var Qe;function gr(){return Qe||(Qe=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Ee();t.DefaultFunctionDefinitions=new e.FunctionDefinitionList,t.DefaultFunctionDefinitions.floor=function(a,n,h){return Math.floor(a.evaluate(n.getChild(0),h))},t.DefaultFunctionDefinitions.ceil=function(a,n,h){return Math.ceil(a.evaluate(n.getChild(0),h))},t.DefaultFunctionDefinitions.abs=function(a,n,h){return Math.abs(a.evaluate(n.getChild(0),h))},t.DefaultFunctionDefinitions.round=function(a,n,h){return Math.round(a.evaluate(n.getChild(0),h))},t.DefaultFunctionDefinitions.sqrt=function(a,n,h){return Math.sqrt(a.evaluate(n.getChild(0),h))}}(be)),be}var J={},Ye;function _t(){if(Ye)return J;Ye=1,Object.defineProperty(J,"__esModule",{value:!0});var t=function(){function e(a,n,h){h===void 0&&(h=new Error().stack),this.message=a,this.expression=n,this.stack=h}return e}();return J.InterpreterError=t,J}var Xe;function Ne(){if(Xe)return Y;Xe=1,Object.defineProperty(Y,"__esModule",{value:!0});var t=se(),e=De(),a=Tt(),n=gr(),h=_e(),i=_t(),v=function(){function p(o,c,f,s){this.functions=n.DefaultFunctionDefinitions,Object.assign(this.functions,o),this.random=c||new a.DefaultRandomProvider,this.generator=f||new e.DiceGenerator,this.options=s||{}}return p.prototype.interpret=function(o){var c=o.copy(),f=[],s=this.evaluate(c,f),l=this.countSuccesses(c,f),r=this.countFailures(c,f),u=this.generator.generate(c);return new h.DiceResult(c,u,s,l,r,f)},p.prototype.evaluate=function(o,c){if(!o)return c.push(new i.InterpreterError("Unexpected null node reference found.",o)),0;if(o.type===t.NodeType.DiceRoll)return this.evaluateDiceRoll(o,c);if(o.type===t.NodeType.Number)return this.evaluateNumber(o,c);if(o.type===t.NodeType.DiceSides)return this.evaluateDiceSides(o,c);if(!o.getAttribute("value")){var f=0;switch(o.type){case t.NodeType.Add:f=this.evaluateAdd(o,c);break;case t.NodeType.Subtract:f=this.evaluateSubtract(o,c);break;case t.NodeType.Multiply:f=this.evaluateMultiply(o,c);break;case t.NodeType.Divide:f=this.evaluateDivide(o,c);break;case t.NodeType.Modulo:f=this.evaluateModulo(o,c);break;case t.NodeType.Negate:f=this.evaluateNegate(o,c);break;case t.NodeType.Exponent:f=this.evaluateExponent(o,c);break;case t.NodeType.Dice:f=this.evaluateDice(o,c);break;case t.NodeType.Function:f=this.evaluateFunction(o,c);break;case t.NodeType.Group:f=this.evaluateGroup(o,c);break;case t.NodeType.Repeat:f=this.evaluateRepeat(o,c);break;case t.NodeType.Explode:f=this.evaluateExplode(o,c);break;case t.NodeType.Keep:f=this.evaluateKeep(o,c);break;case t.NodeType.Drop:f=this.evaluateDrop(o,c);break;case t.NodeType.Critical:f=this.evaluateCritical(o,c);break;case t.NodeType.Reroll:f=this.evaluateReroll(o,c);break;case t.NodeType.Sort:f=this.evaluateSort(o,c);break;case t.NodeType.Equal:f=this.evaluateEqual(o,c);break;case t.NodeType.Greater:f=this.evaluateGreater(o,c);break;case t.NodeType.GreaterOrEqual:f=this.evaluateGreaterOrEqual(o,c);break;case t.NodeType.Less:f=this.evaluateLess(o,c);break;case t.NodeType.LessOrEqual:f=this.evaluateLessOrEqual(o,c);break;default:return c.push(new i.InterpreterError("Unrecognized node type '"+o.type+"'.",o)),0}o.setAttribute("value",f)}return o.getAttribute("value")},p.prototype.evaluateAdd=function(o,c){return this.expectChildCount(o,2,c)?this.evaluate(o.getChild(0),c)+this.evaluate(o.getChild(1),c):0},p.prototype.evaluateSubtract=function(o,c){return this.expectChildCount(o,2,c)?this.evaluate(o.getChild(0),c)-this.evaluate(o.getChild(1),c):0},p.prototype.evaluateMultiply=function(o,c){return this.expectChildCount(o,2,c)?this.evaluate(o.getChild(0),c)*this.evaluate(o.getChild(1),c):0},p.prototype.evaluateDivide=function(o,c){return this.expectChildCount(o,2,c)?this.evaluate(o.getChild(0),c)/this.evaluate(o.getChild(1),c):0},p.prototype.evaluateModulo=function(o,c){return this.expectChildCount(o,2,c)?this.evaluate(o.getChild(0),c)%this.evaluate(o.getChild(1),c):0},p.prototype.evaluateExponent=function(o,c){return this.expectChildCount(o,2,c)?Math.pow(this.evaluate(o.getChild(0),c),this.evaluate(o.getChild(1),c)):0},p.prototype.evaluateNegate=function(o,c){return this.expectChildCount(o,1,c)?-this.evaluate(o.getChild(0),c):0},p.prototype.evaluateNumber=function(o,c){return o.getAttribute("value")},p.prototype.evaluateDiceSides=function(o,c){return o.getAttribute("value")},p.prototype.evaluateDiceRoll=function(o,c){return o.getAttribute("drop")!==!0?o.getAttribute("value"):0},p.prototype.evaluateDice=function(o,c){if(!this.expectChildCount(o,2,c))return 0;var f=Math.round(this.evaluate(o.getChild(0),c)),s=this.options,l=s.maxRollTimes,r=s.maxDiceSides;if(l&&f>l)return c.push(new i.InterpreterError("Invalid number of rolls: "+f+". Maximum allowed: "+l+".",o)),null;var u=o.getChild(1),d=this.evaluate(u,c);if(r&&d>r)return c.push(new i.InterpreterError("Invalid number of dice sides: "+d+". Maximum allowed: "+r+".",o)),null;o.setAttribute("sides",d),o.clearChildren();for(var y=0,b=0;b<f;b++){var g=this.createDiceRoll(u,c);o.addChild(g),y+=this.evaluate(g,c)}return y},p.prototype.evaluateFunction=function(o,c){var f=o.getAttribute("name");if(Object.keys(this.functions).indexOf(f)===-1)return c.push(new i.InterpreterError("Unknown function: "+f,o)),0;var s=this.functions[f](this,o,c);return s},p.prototype.evaluateGroup=function(o,c){var f=this,s=0;return o.forEachChild(function(l){s+=f.evaluate(l,c)}),s},p.prototype.evaluateRepeat=function(o,c){if(!this.expectChildCount(o,2,c))return 0;var f=o.getChild(0),s=this.evaluate(o.getChild(1),c),l=o.getParent();l.removeChild(o);for(var r=0,u=0;u<s;u++){var d=f.copy();l.addChild(d),r+=this.evaluate(d,c)}return r},p.prototype.evaluateExplode=function(o,c){var f=this;if(!this.expectChildCount(o,1,c))return 0;var s=this.findDiceOrGroupNode(o,c);if(!s)return 0;var l=o.getAttribute("penetrate"),r=s.getAttribute("sides"),u;if(o.getChildCount()>1){if(u=o.getChild(1),this.wouldRollAgainForever(s,u,c))return 0}else u=t.Factory.create(t.NodeType.Equal),u.addChild(t.Factory.create(t.NodeType.Number).setAttribute("value",r));this.evaluate(s,c);var d=[],y=0;return s.forEachChild(function(b){if(!b.getAttribute("drop")){var g=f.evaluate(b,c);for(y+=g;u&&f.evaluateComparison(g,u,c);)b=f.createDiceRoll(r,c),g=f.evaluate(b,c),l&&(g-=1),y+=g,d.push(b)}}),d.forEach(function(b){return s.addChild(b)}),y},p.prototype.evaluateKeep=function(o,c){if(!this.expectChildCount(o,1,c))return 0;var f=this.findDiceOrGroupNode(o,c);if(!f)return 0;var s=o.getChildCount()>1?this.evaluate(o.getChild(1),c):1,l=o.getAttribute("type");this.evaluate(f,c);var r=this.getSortedDiceRolls(f,l==="lowest"?"ascending":"descending",c).rolls,u=0,d=0;return r.forEach(function(y){u<s?(y.setAttribute("drop",!1),d+=y.getAttribute("value")):y.setAttribute("drop",!0),u++}),d},p.prototype.evaluateDrop=function(o,c){if(!this.expectChildCount(o,1,c))return 0;var f=this.findDiceOrGroupNode(o,c);if(!f)return 0;var s=o.getChildCount()>1?this.evaluate(o.getChild(1),c):1,l=o.getAttribute("type");this.evaluate(f,c);var r=this.getSortedDiceRolls(f,l==="lowest"?"ascending":"descending",c).rolls,u=0,d=0;return r.forEach(function(y){u<s?y.setAttribute("drop",!0):(y.setAttribute("drop",!1),d+=y.getAttribute("value")),u++}),d},p.prototype.evaluateCritical=function(o,c){var f=this;if(!this.expectChildCount(o,1,c))return 0;var s=this.findDiceOrGroupNode(o,c);if(!s)return 0;var l=o.getAttribute("type"),r;o.getChildCount()>1?r=o.getChild(1):(r=t.Factory.create(t.NodeType.Equal),l==="success"?(this.expectChildCount(s,2,c),r.addChild(t.Factory.create(t.NodeType.Number).setAttribute("value",s.getAttribute("sides")))):r.addChild(t.Factory.create(t.NodeType.Number).setAttribute("value",1))),this.evaluate(s,c);var u=0;return s.forEachChild(function(d){var y=f.evaluate(d,c);f.evaluateComparison(y,r,c)&&(d.setAttribute("critical",l),u+=y)}),u},p.prototype.evaluateReroll=function(o,c){var f=this;if(!this.expectChildCount(o,1,c))return 0;var s=this.findDiceOrGroupNode(o,c);if(!s)return 0;var l,r=o.getAttribute("once");if(o.getChildCount()>1){if(l=o.getChild(1),this.wouldRollAgainForever(s,l,c))return 0}else l=t.Factory.create(t.NodeType.Equal),l.addChild(t.Factory.create(t.NodeType.Number).setAttribute("value",1));this.evaluate(s,c);var u=0,d=s.getAttribute("sides");return s.forEachChild(function(y){if(!y.getAttribute("drop")){for(var b=f.evaluate(y,c);l&&f.evaluateComparison(b,l,c)&&(b=f.createDiceRollValue(d,c),!r););y.setAttribute("value",b),u+=b}}),u},p.prototype.evaluateSort=function(o,c){if(!this.expectChildCount(o,1,c))return 0;var f=this.findDiceOrGroupNode(o,c);if(!f)return 0;var s=this.getSortedDiceRolls(f,o.getAttribute("direction"),c);return f.clearChildren(),s.rolls.forEach(function(l){return f.addChild(l)}),s.total},p.prototype.evaluateEqual=function(o,c){return this.evaluateSuccess(o,function(f,s){return f===s},c)},p.prototype.evaluateGreater=function(o,c){return this.evaluateSuccess(o,function(f,s){return f>s},c)},p.prototype.evaluateGreaterOrEqual=function(o,c){return this.evaluateSuccess(o,function(f,s){return f>=s},c)},p.prototype.evaluateLess=function(o,c){return this.evaluateSuccess(o,function(f,s){return f<s},c)},p.prototype.evaluateLessOrEqual=function(o,c){return this.evaluateSuccess(o,function(f,s){return f<=s},c)},p.prototype.countSuccesses=function(o,c){return this.countSuccessOrFailure(o,function(f){return f.getAttribute("success")},c)},p.prototype.countFailures=function(o,c){return this.countSuccessOrFailure(o,function(f){return!f.getAttribute("success")},c)},p.prototype.countSuccessOrFailure=function(o,c,f){var s=this,l=0;return o.type===t.NodeType.Dice||o.type===t.NodeType.Group?o.forEachChild(function(r){!r.getAttribute("drop")&&c(r)&&l++}):o.forEachChild(function(r){l+=s.countSuccessOrFailure(r,c,f)}),l},p.prototype.expectChildCount=function(o,c,f){var s=o.getChildCount();if(s<c){var l=new i.InterpreterError("Expected "+o.type+" node to have "+c+" children, but found "+s+".",o);return f.push(l),!1}return!0},p.prototype.evaluateComparison=function(o,c,f){if(!this.expectChildCount(c,1,f))return!1;switch(c.type){case t.NodeType.Equal:return o===this.evaluate(c.getChild(0),f);case t.NodeType.Greater:return o>this.evaluate(c.getChild(0),f);case t.NodeType.GreaterOrEqual:return o>=this.evaluate(c.getChild(0),f);case t.NodeType.Less:return o<this.evaluate(c.getChild(0),f);case t.NodeType.LessOrEqual:return o<=this.evaluate(c.getChild(0),f);default:return f.push(new i.InterpreterError("Unrecognized comparison operator '"+c.type+"'.",c)),!1}},p.prototype.evaluateSuccess=function(o,c,f){var s=this;if(!this.expectChildCount(o,2,f))return 0;var l=this.evaluate(o.getChild(1),f),r=0,u=this.findDiceOrGroupNode(o,f);return u?(u.forEachChild(function(d){if(!d.getAttribute("drop")){var y=s.evaluate(d,f),b=c(s.evaluate(d,f),l);d.setAttribute("success",b),b&&(r+=y)}}),r):0},p.prototype.findDiceOrGroupNode=function(o,c){if(o.type===t.NodeType.Dice||o.type===t.NodeType.Group)return o;if(o.getChildCount()<1)return c.push(new i.InterpreterError("Missing dice/group node.",o)),null;var f=o.getChild(0);return this.evaluate(f,c),this.findDiceOrGroupNode(f,c)},p.prototype.getSortedDiceRolls=function(o,c,f){var s=this,l={rolls:[],total:0};o.forEachChild(function(u){l.rolls.push(u),l.total+=s.evaluate(u,f)});var r;return c==="descending"?r=function(u,d){return d.getAttribute("value")-u.getAttribute("value")}:c==="ascending"?r=function(u,d){return u.getAttribute("value")-d.getAttribute("value")}:f.push(new i.InterpreterError("Unknown sort direction: "+c+". Expected 'ascending' or 'descending'.",o)),l.rolls=l.rolls.sort(r),l},p.prototype.createDiceRoll=function(o,c){o instanceof t.ExpressionNode&&o.getAttribute("value");var f=this.createDiceRollValue(o,c);return t.Factory.create(t.NodeType.DiceRoll).setAttribute("value",f).setAttribute("drop",!1)},p.prototype.createDiceRollValue=function(o,c){var f=1,s=0,l=o instanceof t.ExpressionNode?o.getAttribute("value"):o;return l==="fate"?(f=-1,s=1):s=Math.round(o instanceof t.ExpressionNode?this.evaluate(o,c):o),this.random.numberBetween(f,s)},p.prototype.wouldRollAgainForever=function(o,c,f){var s=o.getAttribute("sides"),l=c.getChild(0).getAttribute("value"),r=!1;switch(c.type){case t.NodeType.Equal:r=s===1&&l===1;break;case t.NodeType.Greater:r=l<1;break;case t.NodeType.GreaterOrEqual:r=l<=1;break;case t.NodeType.Less:r=l>s;break;case t.NodeType.LessOrEqual:r=l>=s}return r&&f.push(new i.InterpreterError("Condition to roll again includes all dice faces and would run forever.",c)),r},p}();return Y.DiceInterpreter=v,Y}var Je;function yr(){return Je||(Je=1,function(t){function e(a){for(var n in a)t.hasOwnProperty(n)||(t[n]=a[n])}Object.defineProperty(t,"__esModule",{value:!0}),e(_e()),e(Ne()),e(_t()),e(Ee()),e(Ee()),e(Ne()),e(_e())}(ye)),ye}var ke={},ee={},et;function Et(){if(et)return ee;et=1,Object.defineProperty(ee,"__esModule",{value:!0});var t=function(){function e(a,n,h){this.message=a,this.token=n,this.stackTrace=h}return e}();return ee.ParserError=t,ee}var te={},tt;function Nt(){if(tt)return te;tt=1,Object.defineProperty(te,"__esModule",{value:!0});var t=function(){function e(){this.errors=[]}return e}();return te.ParseResult=t,te}var L={},Ce={},re={},rt;function wt(){if(rt)return re;rt=1,Object.defineProperty(re,"__esModule",{value:!0});var t=function(){function e(a){this.input=a,this.index=-1}return e.prototype.getCurrentPosition=function(){return this.index},e.prototype.getNextCharacter=function(){return this.index=Math.min(this.index+1,this.input.length),this.index>=this.input.length?null:this.input[this.index]},e.prototype.getCurrentCharacter=function(){return this.index<0||this.index>=this.input.length?null:this.input[this.index]},e.prototype.peekNextCharacter=function(){return this.index>=this.input.length?null:this.input[this.index+1]},e}();return re.StringCharacterStream=t,re}var ne={},ie={},nt;function Dt(){if(nt)return ie;nt=1,Object.defineProperty(ie,"__esModule",{value:!0});var t=function(){function e(a,n,h){this.type=a,this.position=n,this.value=h}return e}();return ie.Token=t,ie}var me={},it;function Rt(){return it||(it=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Equals="="]="Equals",e[e.Greater=">"]="Greater",e[e.GreaterOrEqual=">="]="GreaterOrEqual",e[e.Less="<"]="Less",e[e.LessOrEqual="<="]="LessOrEqual",e[e.BraceClose="}"]="BraceClose",e[e.BraceOpen="{"]="BraceOpen",e[e.Comma=","]="Comma",e[e.Ellipsis="..."]="Ellipsis",e[e.Identifier="identifier"]="Identifier",e[e.Plus="+"]="Plus",e[e.Slash="/"]="Slash",e[e.DoubleAsterisk="**"]="DoubleAsterisk",e[e.Percent="%"]="Percent",e[e.Asterisk="*"]="Asterisk",e[e.Minus="-"]="Minus",e[e.Number="number"]="Number",e[e.ParenthesisClose=")"]="ParenthesisClose",e[e.ParenthesisOpen="("]="ParenthesisOpen",e[e.Terminator="terminator"]="Terminator",e[e.Exclamation="!"]="Exclamation"}(t.TokenType||(t.TokenType={}))}(me)),me}var at;function At(){if(at)return ne;at=1,Object.defineProperty(ne,"__esModule",{value:!0});var t=wt(),e=Dt(),a=Rt(),n=function(){function h(i){if(this.numCharRegex=/[0-9]/,this.idCharRegex=/[a-zA-Z]/,this.isCharacterStream(i))this.stream=i;else if(typeof i=="string")this.stream=new t.StringCharacterStream(i);else throw new Error("Unrecognized input type. input must be of type 'CharacterStream | string'.")}return h.prototype.isCharacterStream=function(i){return i.getCurrentCharacter},h.prototype.peekNextToken=function(){return this.nextToken||(this.nextToken=this.constructNextToken()),this.nextToken},h.prototype.getNextToken=function(){return this.nextToken?(this.currentToken=this.nextToken,this.nextToken=null):this.currentToken=this.constructNextToken(),this.currentToken},h.prototype.parseIdentifier=function(){for(var i=this.stream.getCurrentCharacter();this.stream.peekNextCharacter()&&this.idCharRegex.test(this.stream.peekNextCharacter());)i+=this.stream.getNextCharacter();return this.createToken(a.TokenType.Identifier,i)},h.prototype.parseNumber=function(){for(var i=this.stream.getCurrentCharacter(),v=!1,p=this.stream.peekNextCharacter();p==="."||this.numCharRegex.test(p);){if(p==="."){if(v)break;v=!0}i+=this.stream.getNextCharacter(),p=this.stream.peekNextCharacter()}return this.createToken(a.TokenType.Number,i)},h.prototype.parseEllipsis=function(){for(var i=0;i<2;i++){if(this.stream.peekNextCharacter()!==".")throw new Error("Missing period in ellipsis.");this.stream.getNextCharacter()}return this.createToken(a.TokenType.Ellipsis,"...")},h.prototype.constructNextToken=function(){for(var i;i=this.stream.getNextCharacter();)switch(!0){case this.idCharRegex.test(i):return this.parseIdentifier();case this.numCharRegex.test(i):return this.parseNumber();case i==="{":return this.createToken(a.TokenType.BraceOpen,i);case i==="}":return this.createToken(a.TokenType.BraceClose,i);case i===",":return this.createToken(a.TokenType.Comma,i);case i==="(":return this.createToken(a.TokenType.ParenthesisOpen,i);case i===")":return this.createToken(a.TokenType.ParenthesisClose,i);case i==="=":return this.createToken(a.TokenType.Equals,i);case i==="+":return this.createToken(a.TokenType.Plus,i);case i==="/":return this.createToken(a.TokenType.Slash,i);case i==="-":return this.createToken(a.TokenType.Minus,i);case i==="%":return this.createToken(a.TokenType.Percent,i);case i==="!":return this.createToken(a.TokenType.Exclamation,i);case i===".":return this.parseEllipsis();case i==="*":return this.stream.peekNextCharacter()==="*"?(this.stream.getNextCharacter(),this.createToken(a.TokenType.DoubleAsterisk,i+this.stream.getCurrentCharacter())):this.createToken(a.TokenType.Asterisk,i);case i===">":return this.stream.peekNextCharacter()==="="?(this.stream.getNextCharacter(),this.createToken(a.TokenType.GreaterOrEqual,i+this.stream.getCurrentCharacter())):this.createToken(a.TokenType.Greater,i);case i==="<":return this.stream.peekNextCharacter()==="="?(this.stream.getNextCharacter(),this.createToken(a.TokenType.LessOrEqual,i+this.stream.getCurrentCharacter())):this.createToken(a.TokenType.Less,i);case/\W/.test(i):break;default:throw new Error("Unknown token: '"+i+"'.")}return this.createToken(a.TokenType.Terminator)},h.prototype.createToken=function(i,v){var p=this.stream.getCurrentPosition();return v&&(p-=v.length-1),new e.Token(i,p,v)},h}();return ne.DiceLexer=n,ne}var G={},ut;function br(){if(ut)return G;ut=1;var t=G&&G.__extends||function(){var a=function(n,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,v){i.__proto__=v}||function(i,v){for(var p in v)v.hasOwnProperty(p)&&(i[p]=v[p])},a(n,h)};return function(n,h){a(n,h);function i(){this.constructor=n}n.prototype=h===null?Object.create(h):(i.prototype=h.prototype,new i)}}();Object.defineProperty(G,"__esModule",{value:!0});var e=function(a){t(n,a);function n(){return a.call(this,"TokenDefinition pattern RegExp must be global.")||this}return n}(Error);return G.NonGlobalDefinitionError=e,G}var ot;function Ot(){return ot||(ot=1,function(t){function e(a){for(var n in a)t.hasOwnProperty(n)||(t[n]=a[n])}Object.defineProperty(t,"__esModule",{value:!0}),e(wt()),e(At()),e(br()),e(Rt()),e(Dt())}(Ce)),Ce}var ae={},ct;function It(){if(ct)return ae;ct=1,Object.defineProperty(ae,"__esModule",{value:!0});var t=Ot(),e=Et(),a=function(){function n(h){if(this.isLexer(h))this.lexer=h;else if(typeof h=="string")this.lexer=new t.DiceLexer(h);else throw new Error("Unrecognized input type. input must be of type 'Lexer | string'.")}return n.prototype.isLexer=function(h){return h.getNextToken},n.prototype.expectAndConsume=function(h,i,v){return this.expect(h,i,v),this.lexer.getNextToken()},n.prototype.expect=function(h,i,v){return v=v||this.lexer.peekNextToken(),v.type!==i&&this.errorToken(h,i,v),v},n.prototype.errorToken=function(h,i,v){var p="Error at position "+v.position+".";p+=" Expected token of type "+i+", found token of type "+v.type+' of value "'+v.value+'".',this.errorMessage(h,p,v)},n.prototype.errorMessage=function(h,i,v){h.errors.push(new e.ParserError(i,v,new Error().stack))},n}();return ae.BasicParser=a,ae}var st;function St(){if(st)return L;st=1;var t=L&&L.__extends||function(){var c=function(f,s){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,r){l.__proto__=r}||function(l,r){for(var u in r)r.hasOwnProperty(u)&&(l[u]=r[u])},c(f,s)};return function(f,s){c(f,s);function l(){this.constructor=f}f.prototype=s===null?Object.create(s):(l.prototype=s.prototype,new l)}}();Object.defineProperty(L,"__esModule",{value:!0});var e=se(),a=Ot(),n=It(),h=Nt(),i={};i[a.TokenType.Equals]=e.NodeType.Equal,i[a.TokenType.Greater]=e.NodeType.Greater,i[a.TokenType.Less]=e.NodeType.Less,i[a.TokenType.GreaterOrEqual]=e.NodeType.GreaterOrEqual,i[a.TokenType.LessOrEqual]=e.NodeType.LessOrEqual;var v={};v[a.TokenType.Plus]=e.NodeType.Add,v[a.TokenType.Minus]=e.NodeType.Subtract;var p={};p[a.TokenType.DoubleAsterisk]=e.NodeType.Exponent,p[a.TokenType.Asterisk]=e.NodeType.Multiply,p[a.TokenType.Slash]=e.NodeType.Divide,p[a.TokenType.Percent]=e.NodeType.Modulo;var o=function(c){t(f,c);function f(s){return c.call(this,s)||this}return f.prototype.parse=function(){var s=new h.ParseResult;return s.root=this.parseExpression(s),s},f.prototype.parseExpression=function(s){var l=this.parseSimpleExpression(s),r=this.lexer.peekNextToken().type;if(Object.keys(i).indexOf(r.toString())>-1){var u=e.Factory.create(i[r]);this.lexer.getNextToken(),u.addChild(l),u.addChild(this.parseSimpleExpression(s)),l=u}return l},f.prototype.parseSimpleExpression=function(s){var l=this.lexer.peekNextToken().type;Object.keys(v).indexOf(l.toString())>-1&&this.lexer.getNextToken();var r=this.parseTerm(s);if(l===a.TokenType.Minus){var u=e.Factory.create(e.NodeType.Negate);u.addChild(r),r=u}for(l=this.lexer.peekNextToken().type;Object.keys(v).indexOf(l.toString())>-1;){var d=e.Factory.create(v[l]);d.addChild(r),this.lexer.getNextToken(),d.addChild(this.parseTerm(s)),r=d,l=this.lexer.peekNextToken().type}return r},f.prototype.parseTerm=function(s){for(var l=this.parseFactor(s),r=this.lexer.peekNextToken().type;Object.keys(p).indexOf(r.toString())>-1;){var u=e.Factory.create(p[r]);u.addChild(l),this.lexer.getNextToken(),u.addChild(this.parseFactor(s)),l=u,r=this.lexer.peekNextToken().type}return l},f.prototype.parseFactor=function(s){var l,r=this.lexer.peekNextToken();switch(r.type){case a.TokenType.Identifier:r.value==="d"||r.value==="dF"?l=this.parseDice(s):l=this.parseFunction(s);break;case a.TokenType.ParenthesisOpen:l=this.parseBracketedExpression(s),this.lexer.peekNextToken().type===a.TokenType.Identifier&&(l=this.parseDice(s,l));break;case a.TokenType.BraceOpen:l=this.parseGroup(s);break;case a.TokenType.Number:var u=this.parseNumber(s);this.lexer.peekNextToken().type!==a.TokenType.Identifier?l=u:l=this.parseDice(s,u);break;default:this.errorToken(s,a.TokenType.Number,r)}return l},f.prototype.parseSimpleFactor=function(s){var l=this.lexer.peekNextToken();switch(l.type){case a.TokenType.Number:return this.parseNumber(s);case a.TokenType.ParenthesisOpen:return this.parseBracketedExpression(s);case a.TokenType.Identifier:return e.Factory.create(e.NodeType.Number).setAttribute("value",1);default:this.errorToken(s,a.TokenType.Number,l)}},f.prototype.parseFunction=function(s){var l=this.expectAndConsume(s,a.TokenType.Identifier),r=e.Factory.create(e.NodeType.Function).setAttribute("name",l.value);this.expectAndConsume(s,a.TokenType.ParenthesisOpen);var u=this.lexer.peekNextToken();if(u.type!==a.TokenType.ParenthesisClose)for(r.addChild(this.parseExpression(s));this.lexer.peekNextToken().type===a.TokenType.Comma;)this.lexer.getNextToken(),r.addChild(this.parseExpression(s));return this.expectAndConsume(s,a.TokenType.ParenthesisClose),r},f.prototype.parseNumber=function(s){var l=this.lexer.getNextToken();return e.Factory.create(e.NodeType.Number).setAttribute("value",Number(l.value))},f.prototype.parseBracketedExpression=function(s){this.lexer.getNextToken();var l=this.parseExpression(s);return this.expectAndConsume(s,a.TokenType.ParenthesisClose),l},f.prototype.parseGroup=function(s){this.lexer.getNextToken();var l=e.Factory.create(e.NodeType.Group),r=this.lexer.peekNextToken();if(r.type!==a.TokenType.BraceClose)do{this.lexer.peekNextToken().type===a.TokenType.Comma&&this.lexer.getNextToken();var u=this.parseExpression(s);this.lexer.peekNextToken().type===a.TokenType.Ellipsis&&(u=this.parseRepeat(s,u)),l.addChild(u)}while(this.lexer.peekNextToken().type===a.TokenType.Comma);return this.expectAndConsume(s,a.TokenType.BraceClose),this.parseGroupModifiers(s,l)},f.prototype.parseRepeat=function(s,l){this.lexer.getNextToken();var r=e.Factory.create(e.NodeType.Repeat);return r.addChild(l),r.addChild(this.parseExpression(s)),r},f.prototype.parseDice=function(s,l){var r=this.parseDiceRoll(s,l);return r=this.parseDiceModifiers(s,r),r},f.prototype.parseDiceRoll=function(s,l){l||(l=this.parseSimpleFactor(s));var r=this.expectAndConsume(s,a.TokenType.Identifier),u=e.Factory.create(e.NodeType.Dice);switch(u.addChild(l),r.value){case"d":var d=this.expectAndConsume(s,a.TokenType.Number);u.addChild(e.Factory.create(e.NodeType.DiceSides)).setAttribute("value",Number(d.value));break;case"dF":u.addChild(e.Factory.create(e.NodeType.DiceSides)).setAttribute("value","fate");break}return u},f.prototype.parseExplode=function(s,l){var r=e.Factory.create(e.NodeType.Explode);r.setAttribute("compound",!1),r.setAttribute("penetrate",!1),l&&r.addChild(l),this.lexer.getNextToken();var u=this.lexer.peekNextToken();u.type===a.TokenType.Exclamation&&(r.setAttribute("compound",!0),this.lexer.getNextToken()),u=this.lexer.peekNextToken(),u.type===a.TokenType.Identifier&&(u.value==="p"&&r.setAttribute("penetrate",!0),this.lexer.getNextToken());var d=this.lexer.peekNextToken().type;return Object.keys(i).indexOf(d.toString())>-1&&r.addChild(this.parseCompareModifier(s)),r},f.prototype.parseCritical=function(s,l){var r=e.Factory.create(e.NodeType.Critical);r.setAttribute("type","success"),l&&r.addChild(l);var u=this.lexer.peekNextToken();if(u.type===a.TokenType.Identifier)switch(u.value){case"c":r.setAttribute("type","success");break;case"cs":r.setAttribute("type","success");break;case"cf":r.setAttribute("type","failure");break;default:this.errorMessage(s,"Unknown critical type "+u.value+". Must be (c|cs|cf).",u)}this.lexer.getNextToken();var d=this.lexer.peekNextToken().type;return Object.keys(i).indexOf(d.toString())>-1&&r.addChild(this.parseCompareModifier(s)),r},f.prototype.parseKeep=function(s,l){var r=e.Factory.create(e.NodeType.Keep);r.setAttribute("type","highest"),l&&r.addChild(l);var u=this.lexer.peekNextToken();if(u.type===a.TokenType.Identifier)switch(u.value){case"k":r.setAttribute("type","highest");break;case"kh":r.setAttribute("type","highest");break;case"kl":r.setAttribute("type","lowest");break;default:this.errorMessage(s,"Unknown keep type "+u.value+". Must be (k|kh|kl).",u)}this.lexer.getNextToken();var d=this.lexer.peekNextToken().type;return d===a.TokenType.Number||d===a.TokenType.ParenthesisOpen?r.addChild(this.parseSimpleFactor(s)):r.addChild(e.Factory.create(e.NodeType.Number).setAttribute("value",1)),r},f.prototype.parseDrop=function(s,l){var r=e.Factory.create(e.NodeType.Drop);r.setAttribute("type","lowest"),l&&r.addChild(l);var u=this.lexer.peekNextToken();if(u.type===a.TokenType.Identifier)switch(u.value){case"d":r.setAttribute("type","lowest");break;case"dh":r.setAttribute("type","highest");break;case"dl":r.setAttribute("type","lowest");break;default:this.errorMessage(s,"Unknown drop type "+u.value+". Must be (d|dh|dl).",u)}this.lexer.getNextToken();var d=this.lexer.peekNextToken().type;return(d===a.TokenType.Number||d===a.TokenType.ParenthesisOpen)&&r.addChild(this.parseSimpleFactor(s)),r},f.prototype.parseReroll=function(s,l){var r=e.Factory.create(e.NodeType.Reroll);r.setAttribute("once",!1),l&&r.addChild(l);var u=this.lexer.peekNextToken();if(u.type===a.TokenType.Identifier)switch(u.value){case"r":r.setAttribute("once",!1);break;case"ro":r.setAttribute("once",!0);break;default:this.errorMessage(s,"Unknown drop type "+u.value+". Must be (r|ro).",u)}this.lexer.getNextToken();var d=this.lexer.peekNextToken().type;return Object.keys(i).indexOf(d.toString())>-1&&r.addChild(this.parseCompareModifier(s)),r},f.prototype.parseSort=function(s,l){var r=e.Factory.create(e.NodeType.Sort);r.setAttribute("direction","ascending"),l&&r.addChild(l);var u=this.lexer.peekNextToken();if(u.type===a.TokenType.Identifier)switch(u.value){case"s":r.setAttribute("direction","ascending");break;case"sa":r.setAttribute("direction","ascending");break;case"sd":r.setAttribute("direction","descending");break;default:this.errorMessage(s,"Unknown sort type "+u.value+". Must be (s|sa|sd).",u)}return this.lexer.getNextToken(),r},f.prototype.parseCompareModifier=function(s,l){var r=this.lexer.peekNextToken(),u;return r.type===a.TokenType.Number?u=e.Factory.create(e.NodeType.Equal):Object.keys(i).indexOf(r.type.toString())>-1?(u=e.Factory.create(i[r.type]),this.lexer.getNextToken()):this.errorToken(s,a.TokenType.Number,r),l&&u.addChild(l),u.addChild(this.parseSimpleFactor(s)),u},f.prototype.parseDiceModifiers=function(s,l){for(;;){var r=this.lexer.peekNextToken();if(Object.keys(i).indexOf(r.type.toString())>-1)l=this.parseCompareModifier(s,l);else if(r.type===a.TokenType.Identifier)switch(r.value[0]){case"c":l=this.parseCritical(s,l);break;case"d":l=this.parseDrop(s,l);break;case"k":l=this.parseKeep(s,l);break;case"r":l=this.parseReroll(s,l);break;case"s":l=this.parseSort(s,l);break;default:return this.errorToken(s,a.TokenType.Identifier,r),l}else if(r.type===a.TokenType.Exclamation)l=this.parseExplode(s,l);else break}return l},f.prototype.parseGroupModifiers=function(s,l){for(;;){var r=this.lexer.peekNextToken();if(Object.keys(i).indexOf(r.type.toString())>-1)l=this.parseCompareModifier(s,l);else if(r.type===a.TokenType.Identifier)switch(r.value[0]){case"d":l=this.parseDrop(s,l);break;case"k":l=this.parseKeep(s,l);break;case"s":l=this.parseSort(s,l);break;default:return this.errorToken(s,a.TokenType.Identifier,r),l}else break}return l},f}(n.BasicParser);return L.DiceParser=o,L}var lt;function kr(){return lt||(lt=1,function(t){function e(a){for(var n in a)t.hasOwnProperty(n)||(t[n]=a[n])}Object.defineProperty(t,"__esModule",{value:!0}),e(Et()),e(Nt()),e(St()),e(It())}(ke)),ke}var ue={},ft;function Cr(){if(ft)return ue;ft=1,Object.defineProperty(ue,"__esModule",{value:!0});var t=De(),e=Ne(),a=At(),n=St(),h=function(){function i(v,p,o){this.functions=v,this.randomProvider=p,this.options=o}return i.prototype.roll=function(v){var p=this.createLexer(v),o=this.createParser(p),c=this.createInterpreter(),f=o.parse();return c.interpret(f.root)},i.prototype.createLexer=function(v){return new a.DiceLexer(v)},i.prototype.createParser=function(v){return new n.DiceParser(v)},i.prototype.createInterpreter=function(){return new e.DiceInterpreter(this.functions,this.randomProvider,this.createGenerator(),this.options)},i.prototype.createGenerator=function(){return new t.DiceGenerator},i}();return ue.Dice=h,ue}var ht;function mr(){return ht||(ht=1,function(t){function e(a){for(var n in a)t.hasOwnProperty(n)||(t[n]=a[n])}Object.defineProperty(t,"__esModule",{value:!0}),e(se()),e(Tt()),e(De()),e(yr()),e(kr()),e(Cr())}(he)),he}var xr=mr();function Tr(t){const e={flex:!1,direction:"row",border:"top",height:"3em"},a=t.roll.userName&&_.jsxs(P,{color:"text-fade",as:"em",children:[t.roll.userName,":"," "]});return!t.roll.result.includes("[")&&t.roll.total===0?_.jsx(F,{...e,align:"center",children:_.jsxs(P,{children:[a,t.roll.expression]})}):_.jsxs(F,{...e,children:[_.jsx(F,{fill:!0,justify:"center",children:_.jsxs(P,{children:[a,t.roll.expression,_.jsx(B,{icon:Ht,style:{padding:"0 5px 1px"}}),t.roll.result," = ",_.jsx("strong",{children:t.roll.total})]})}),_.jsx(U,{margin:"xxsmall",color:"light-6",hoverIndicator:{color:"auto"},onClick:()=>t.rollDice(t.roll.expression),icon:_.jsx(B,{icon:Zt,size:"xs"})})]})}function _r(t){const{rollDice:e,cardHistory:a}=t,[n,h]=w.useState(0),i=w.useRef(null);return _.jsx(vt,{ref:i,onKeyDown:v=>{if(!i.current)return;const p=i.current;if(v.key==="Enter"&&p.value.length>0&&(e(p.value),p.value="",h(0)),v.key==="ArrowUp"&&n<a.length){const o=a[a.length-(n+1)];o&&(p.value=o.expression,h(n+1))}if(v.key==="ArrowDown"&&n-1>0){const o=a[a.length-(n-1)];o&&(p.value=o.expression,h(n-1))}}})}function Er(t){const{dispatch:e}=w.useContext(gt),[a,n]=w.useState(t.card.showHistoryLength===void 0?0:20-t.card.showHistoryLength),h=w.useRef(null),v=(t.card.quickRolls??qt).join(`
`);return _.jsxs(yt,{cardState:t.card,commands:_.jsxs(_.Fragment,{children:[_.jsx(U,{icon:_.jsx(B,{icon:Qt}),onClick:()=>{e(oe.RevertToDefaultQuickRolls({cardId:t.card.cardId})),t.done()},tip:"Reset to default Quick Rolls"}),_.jsx(U,{icon:_.jsx(B,{icon:Yt}),onClick:()=>{if(!h.current)return;const p=h.current.value.split(`
`);e(oe.SetQuickRolls({cardId:t.card.cardId,quickRolls:p})),e(oe.SetShowHistoryLength({cardId:t.card.cardId,showHistoryLength:a===0?void 0:20-a,unlimited:a===0})),t.done()},tip:"Save"}),","]}),children:[_.jsxs(F,{direction:"row",align:"center",gap:"small",children:[_.jsx(P,{style:{fontWeight:"bold"},margin:"small",children:"Lines of history shown"}),_.jsxs(F,{align:"center",margin:"small",children:[_.jsx(P,{children:a===0?"unlimited":20-a}),_.jsx(we,{min:0,max:19,value:a,onChange:p=>n(parseInt(p.target.value))})]})]}),_.jsxs(F,{direction:"row",flex:"grow",children:[_.jsx(P,{style:{fontWeight:"bold"},margin:"small",children:"Quick Rolls"}),_.jsx(ir,{fill:!0,ref:h,defaultValue:v})]})]})}const Nr=new xr.Dice,qt=["d2","d4","d6","d8","d10","d12","d20","d100"];function Mr(t){var y;const{dispatch:e}=w.useContext(gt),{card:a}=t,n=w.useContext(Xt),h=n!==Se.Player||a.playerViewPermission===Jt.Interact,i=w.useContext(nr),v=w.useCallback(b=>{const g=Nr.roll(b);e(oe.RollDiceExpression({cardId:a.cardId,expression:b,result:g.renderedExpression,total:g.total,userName:i.name||void 0}))},[a.cardId,e,i.name]),[p,o]=w.useState(!1),s=[...(a.quickRolls??qt).map(b=>_.jsx(U,{margin:"xxsmall",onClick:()=>v(b),children:b},"quickroll__"+b)),_.jsx(U,{icon:_.jsx(B,{icon:er}),onClick:()=>o(!0),tip:"Configure"},"configure")],l=tr.slice(a.history||[],-(a.showHistoryLength??0)),r=(((y=a.history)==null?void 0:y.length)??0)-l.length,u=rr(l),d=n===Se.Player&&h&&i.name===null;return p?_.jsx(Er,{card:a,done:()=>o(!1)}):_.jsxs(yt,{cardState:a,commands:s,children:[_.jsxs(F,{overflow:{vertical:"auto"},flex:!0,justify:"start",children:[r>0&&_.jsxs(wr,{children:[r," rolls are hidden"]}),l.map((b,g)=>_.jsx(Tr,{roll:b,rollDice:v},g)),_.jsx("div",{ref:u})]}),d&&_.jsx(vt,{placeholder:"Enter a name to roll dice",onKeyDown:b=>{if(b.key!=="Enter")return;const g=b.target;g.value.length&&i.setName(g.value)}}),!d&&h&&_.jsx(_r,{rollDice:v,cardHistory:l})]})}const wr=dt(P)`
  font-style: italic;
  color: gray;
  text-align: center;
  font-size: smaller;
`;export{Mr as default,qt as defaultQuickRolls};

import{r as l,j as t,a as d}from"./index-0mFGPIzu.js";import{R as g,u as j,H as N,B as b,a as p,G as h,b as w,F as P,f as M,c as k,g as m,r as f,o as S,d as v,e as D,D as A,T as L,V as R,h as T,i as E,j as F,E as I,k as x,p as U}from"./FirebaseUtils-Bz9HKAc4.js";import{u as B,C as O}from"./usePageTitle-BF13zPMT.js";import{P as V}from"./PlayerViewUserContext-Ckiu1h0x.js";import{u as G}from"./useUserIdFromActiveDashboard-3tsmgG4m.js";function H(e){const[s,n]=l.useState("offline");return l.useEffect(()=>{const r=m(d);if(e){const o=f(r,`status/${e}`);return S(o,a=>{n(a.val())}),()=>v(o)}},[e]),s}const W=e=>{var i,c;const{state:s}=l.useContext(g),n=j(),r=G(),a=H(r)==="offline"?" [Offline]":"";return t.jsxs(N,{fill:!0,background:"brand",pad:{left:"10px",right:"10px"},gap:"none",direction:"row",height:"xsmall",children:[t.jsxs(b,{align:"center",direction:"row",fill:!0,style:{whiteSpace:"nowrap"},children:[t.jsx(p,{level:1,size:"small",margin:"none",title:(i=h(s,n))==null?void 0:i.name,children:(c=h(s,n))==null?void 0:c.name}),t.jsxs(p,{level:2,size:"small",margin:{left:"10px"},title:"Paragon Campaign Dashboard: Player View"+a,style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:["Paragon Campaign Dashboard: Player View",a]})]}),t.jsx($,{}),t.jsx(w,{onClick:()=>e.setMatchGMLayout(!e.matchGMLayout),icon:t.jsx(P,{fixedWidth:!0,icon:e.matchGMLayout?M:k}),tip:e.matchGMLayout?"Matching GM layout":"Unlocked from GM layout"})]})};function $(){const[e,s]=l.useState(!1),n=l.useRef(null),r=l.useContext(V);return t.jsxs(t.Fragment,{children:[t.jsx(w,{onClick:()=>s(!e),icon:t.jsx(P,{fixedWidth:!0,icon:D}),tip:"Set Player Name",ref:n}),n.current&&e&&t.jsx(A,{target:n.current,align:{top:"bottom"},onClickOutside:()=>s(!1),children:t.jsx(L,{placeholder:"Player Name",defaultValue:r.name??void 0,onKeyDown:o=>{if(o.key!=="Enter")return;const a=o.target;a.value.length>0&&(r.setName(a.value),s(!1))}})})]})}function y(e,s){const[n,r]=l.useState(()=>{const a=localStorage.getItem(e);return a?JSON.parse(a):s});return[n,a=>{r(a),localStorage.setItem(e,JSON.stringify(a))}]}function z(e){const[s,n]=l.useState(I()),r=j();return l.useEffect(()=>{if(!e)return;const a=m(d),i=f(a,`users/${e}/playerViews/${r}`);return S(i,c=>{const u=c.val();if(!u)return;const C=x.restorePrunedEmptyArrays(u);n(C)}),()=>{v(i)}},[r,e]),[s,a=>{const i=x.removeUndefinedNodesFromTree(a),c=m(d),u=f(c,`pendingActions/${r}`);U(u,i)}]}function Y(){const e=G(),[s,n]=z(e),[r,o]=y("matchGmLayout",!0),[a,i]=y("playerName",null);return B(s),t.jsx(g.Provider,{value:{state:s,dispatch:n},children:t.jsx(R.Provider,{value:T.Player,children:t.jsx(V.Provider,{value:{name:a,setName:i},children:t.jsx(E,{style:{minHeight:"100%"},theme:F,children:t.jsxs(b,{fill:!0,align:"center",children:[t.jsx(W,{matchGMLayout:r,setMatchGMLayout:o}),t.jsx(O,{matchGMLayout:r,setMatchGMLayout:o})]})})})})})}export{Y as default};
